
> construction_management_app@1.0.0 test /home/ubuntu/construction_management_app
> vitest run --reporter\=verbose


[1m[46m RUN [49m[22m [36mv4.0.9 [39m[90m/home/ubuntu/construction_management_app[39m

 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misAdmin[2m > [22mshould return true for admin user[32m 2[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misAdmin[2m > [22mshould return false for regular user[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectMember[2m > [22mshould return true if user is project member[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectMember[2m > [22mshould return false if user is not project member[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectMember[2m > [22mshould return false if database is not available[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectManager[2m > [22mshould return true if user is project manager[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectManager[2m > [22mshould return false if user is not project manager[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misQCInspector[2m > [22mshould return true if user is QC inspector[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misQCInspector[2m > [22mshould return false if user is not QC inspector[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectOwner[2m > [22mshould return true if user is project owner[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectOwner[2m > [22mshould return false if user is not project owner[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22misProjectOwner[2m > [22mshould return false if project does not exist[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanViewProject[2m > [22mshould allow admin to view any project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanViewProject[2m > [22mshould allow project member to view project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanViewProject[2m > [22mshould deny non-member from viewing project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditProject[2m > [22mshould allow admin to edit any project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditProject[2m > [22mshould allow project manager to edit project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditProject[2m > [22mshould allow project owner to edit project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditProject[2m > [22mshould deny regular member from editing project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanDeleteProject[2m > [22mshould allow admin to delete any project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanDeleteProject[2m > [22mshould allow project owner to delete project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanDeleteProject[2m > [22mshould deny non-owner from deleting project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanCreateTask[2m > [22mshould allow admin to create task in any project[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanCreateTask[2m > [22mshould allow project manager to create task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanCreateTask[2m > [22mshould allow QC inspector to create task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanCreateTask[2m > [22mshould deny worker from creating task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditTask[2m > [22mshould allow admin to edit any task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditTask[2m > [22mshould allow project manager to edit task[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditTask[2m > [22mshould allow task assignee to edit task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditTask[2m > [22mshould deny non-assignee from editing task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanEditTask[2m > [22mshould return false if task does not exist[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanDeleteTask[2m > [22mshould allow admin to delete any task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanDeleteTask[2m > [22mshould allow project manager to delete task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcanDeleteTask[2m > [22mshould deny non-manager from deleting task[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireAdmin[2m > [22mshould not throw for admin user[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireAdmin[2m > [22mshould throw FORBIDDEN error for non-admin user[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireProjectMember[2m > [22mshould not throw for admin user[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireProjectMember[2m > [22mshould not throw for project member[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireProjectMember[2m > [22mshould throw FORBIDDEN error for non-member[32m 1[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireProjectManager[2m > [22mshould not throw for admin user[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireProjectManager[2m > [22mshould not throw for project manager[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireProjectManager[2m > [22mshould throw FORBIDDEN error for non-manager[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireQCInspector[2m > [22mshould not throw for admin user[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireQCInspector[2m > [22mshould not throw for QC inspector[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mrequireQCInspector[2m > [22mshould throw FORBIDDEN error for non-inspector[32m 0[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcheckPermission[2m > [22mshould not throw if permission check passes[32m 2[2mms[22m[39m
 [32mâœ“[39m server/middleware/__tests__/permissions.test.ts[2m > [22mPermission Middleware Tests[2m > [22mcheckPermission[2m > [22mshould throw FORBIDDEN error if permission check fails[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskDisplayStatus[2m > [22mshould return completed status for completed tasks[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskDisplayStatus[2m > [22mshould detect overdue tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskDisplayStatus[2m > [22mshould detect at-risk tasks (behind schedule)[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskDisplayStatus[2m > [22mshould detect ahead of schedule tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateExpectedProgress[2m > [22mshould return 0 before start date[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateExpectedProgress[2m > [22mshould return 100 after end date[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateExpectedProgress[2m > [22mshould calculate progress correctly in the middle[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mshouldAutoStartTask[2m > [22mshould return true when start date has passed[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mshouldAutoStartTask[2m > [22mshould return false when start date is in the future[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mshouldAutoStartTask[2m > [22mshould return false for already started tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22misTaskOverdue[2m > [22mshould return true for overdue tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22misTaskOverdue[2m > [22mshould return false for completed tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22misTaskOverdue[2m > [22mshould return false when end date is in the future[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskHealthScore[2m > [22mshould return 100 for completed tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskHealthScore[2m > [22mshould return high score for ahead-of-schedule tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskHealthScore[2m > [22mshould return low score for behind-schedule tasks[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskStatusCalculation.test.ts[2m > [22mTask Status Calculation[2m > [22mcalculateTaskHealthScore[2m > [22mshould penalize overdue tasks[32m 0[2mms[22m[39m
[90mstdout[2m | server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22m[2mMulti-step Checklist Completion Integration Tests
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/services/analytics.service.test.ts[2m > [22m[2mAnalytics Service - SQL Aggregations
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22m[2mDefect Escalation Process Integration Tests
[22m[39m[Database] Connection pool created with limit: 10

Sourcemap for "/home/ubuntu/construction_management_app/node_modules/.pnpm/node-cron@4.2.1/node_modules/node-cron/dist/esm/node-cron.js" points to missing source files
[90mstdout[2m | server/routers.test.ts[2m > [22m[2mTask Procedures Integration Tests
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateProject - Project Creation Transaction[2m > [22m[2mshould create project with valid data
[22m[39m[Database] Connection pool created with limit: 10

 [31mÃ—[39m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould complete checklist items in correct order[33m 1989[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892275598,in_progress,NaN[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetDashboardStats[2m > [22mshould return dashboard statistics using SQL aggregations[33m 2419[2mms[22m[39m
 [31mÃ—[39m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould auto-escalate overdue defect[33m 2175[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892276248,in_progress,NaN[39m
 [31mÃ—[39m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould enforce dependency constraints[33m 720[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892276323,in_progress,NaN[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetProjectStats[2m > [22mshould return project statistics using SQL aggregations[33m 698[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetProjectStats[2m > [22mshould handle non-existent project gracefully[32m 231[2mms[22m[39m
 [31mÃ—[39m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould handle manual escalation by PM[33m 941[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892277195,in_progress,NaN[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.create[2m > [22mshould create task with valid input[33m 483[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetBatchProjectStats[2m > [22mshould return stats for multiple projects using SQL aggregations[33m 696[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetBatchProjectStats[2m > [22mshould handle empty project list[32m 0[2mms[22m[39m
 [31mÃ—[39m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould handle failed checklist items[33m 722[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892277045,in_progress,NaN[39m
 [31mÃ—[39m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould allow re-completion of failed items[33m 722[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892277768,in_progress,NaN[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetCEOProjectStatusBreakdown[2m > [22mshould return project status breakdown using SQL aggregations[32m 237[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.create[2m > [22mshould reject task creation with invalid status[32m 3[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.create[2m > [22mshould reject task creation with invalid priority[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.create[2m > [22mshould reject task creation with invalid progress[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.create[2m > [22mshould reject task creation with empty name[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.create[2m > [22mshould reject task creation with invalid project ID[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculateChecklistStatus[2m > [22mshould return "not_started" for empty checklist[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculateChecklistStatus[2m > [22mshould return "failed" when any item fails[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculateChecklistStatus[2m > [22mshould return "completed" when all items pass or N/A[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculatePassRate[2m > [22mshould calculate pass rate correctly[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculatePassRate[2m > [22mshould return 0 for empty checklist[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculatePassRate[2m > [22mshould return 100 when all applicable items pass[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculatePassRate[2m > [22mshould exclude N/A items from calculation[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mgetFailedItems[2m > [22mshould return only failed items[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mgetFailedItems[2m > [22mshould return empty array when no items fail[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mgetChecklistStats[2m > [22mshould calculate statistics correctly[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mgetChecklistStats[2m > [22mshould handle empty checklist[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mvalidateChecklistCompletion[2m > [22mshould validate completed checklist[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mvalidateChecklistCompletion[2m > [22mshould detect empty checklist[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mvalidateChecklistCompletion[2m > [22mshould detect unchecked items[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mgroupItemsByCategory[2m > [22mshould group items by category correctly[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mgroupItemsByCategory[2m > [22mshould handle items without category[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculateCategoryPassRates[2m > [22mshould calculate pass rates for each category[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistOperations.test.ts[2m > [22mChecklist Operations[2m > [22mcalculateCategoryPassRates[2m > [22mshould handle empty items[32m 0[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetTaskStatusBreakdown[2m > [22mshould return task status breakdown using SQL GROUP BY[32m 235[2mms[22m[39m
 [31mÃ—[39m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould escalate through multiple levels[33m 942[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892278137,in_progress,NaN[39m
[90mstdout[2m | server/__tests__/checklistItemUpdate.test.ts[2m > [22m[2mChecklist Item Update Tests - Comments Field
[22m[39m[Database] Connection pool created with limit: 10

 [31mÃ—[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.update[2m > [22mshould update task with valid data[33m 474[2mms[22m[39m
[31m   â†’ Cannot read properties of undefined (reading 'x-forwarded-for')[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.update[2m > [22mshould reject update with invalid status[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.update[2m > [22mshould reject update with invalid progress[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetTaskStatusBreakdown[2m > [22mshould filter by project ID when provided[33m 462[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetDefectSeverityBreakdown[2m > [22mshould return defect severity breakdown using SQL GROUP BY[32m 236[2mms[22m[39m
 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mAnalytics Service - SQL Aggregations[2m > [22mgetInspectionPassRate[2m > [22mshould return inspection pass rate using SQL aggregations[32m 234[2mms[22m[39m
 [31mÃ—[39m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould prevent escalation beyond critical[33m 939[2mms[22m[39m
[31m   â†’ Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892279077,in_progress,NaN[39m
[90mstdout[2m | server/services/analytics.service.test.ts[2m > [22m[2mPerformance Comparison[2m > [22m[2mshould demonstrate SQL aggregations are faster than JavaScript loops
[22m[39mOptimized (SQL aggregations): 463ms

 [32mâœ“[39m server/services/analytics.service.test.ts[2m > [22mPerformance Comparison[2m > [22mshould demonstrate SQL aggregations are faster than JavaScript loops[33m 695[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByStatus[2m > [22mshould filter tasks by status correctly[32m 2[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByStatus[2m > [22mshould return empty array when no tasks match status[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByPriority[2m > [22mshould filter tasks by priority correctly[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByPriority[2m > [22mshould handle urgent priority[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByAssignee[2m > [22mshould filter tasks by assignee ID[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByAssignee[2m > [22mshould return empty array for non-existent assignee[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByProject[2m > [22mshould filter tasks by project ID[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByDateRange[2m > [22mshould filter tasks within date range[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterTasksByDateRange[2m > [22mshould handle undefined date parameters[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterOverdueTasks[2m > [22mshould identify overdue tasks correctly[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mfilterOverdueTasks[2m > [22mshould not include completed tasks as overdue[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mcalculateTaskStats[2m > [22mshould calculate task statistics correctly[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/taskFiltering.test.ts[2m > [22mTask Filtering Logic[2m > [22mcalculateTaskStats[2m > [22mshould handle empty task array[32m 0[2mms[22m[39m
 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould create project with valid data[33m 2635[2mms[22m[39m
[31m   â†’ expected undefined to be 'Test Project - Critical Transaction' // Object.is equality[39m
 [32mâœ“[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould validate required fields[32m 3[2mms[22m[39m
[90mstdout[2m | server/__tests__/inspection.test.ts[2m > [22m[2mInspection Router
[22m[39m[Database] Connection pool created with limit: 10

 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mcreateDefect[2m > [22mshould create defect with activity log in transaction[32m 4[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mcreateDefect[2m > [22mshould convert BigInt insertId to number[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mcreateDefect[2m > [22mshould create activity log with correct defectId[32m 0[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mupdateDefect[2m > [22mshould update defect with activity log in transaction[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mupdateDefect[2m > [22mshould not create activity log if status not changed[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mupdateDefect[2m > [22mshould handle BigInt defectId conversion[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mdeleteDefect[2m > [22mshould delete defect with all related data in transaction[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mdeleteDefect[2m > [22mshould delete in correct order (attachments, activity logs, defect)[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mTransaction Rollback[2m > [22mshould rollback if defect creation fails[32m 2[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/defect.service.test.ts[2m > [22mDefect Service[2m > [22mTransaction Rollback[2m > [22mshould rollback if activity log creation fails[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould update result and comments successfully[33m 490[2mms[22m[39m
[90mstdout[2m | server/inspection-stats.test.ts[2m > [22m[2mInspection Statistics API[2m > [22m[2mshould get pass/fail rate statistics
[22m[39m[Database] Connection pool created with limit: 10

 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould prevent duplicate project codes[33m 3066[2mms[22m[39m
[31m   â†’ promise resolved "{ success: true, id: 540004 }" instead of rejecting[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould update comments with Thai text[33m 484[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould update comments with long text[33m 484[2mms[22m[39m
 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mInspection Statistics API[2m > [22mshould get pass/fail rate statistics[33m 1447[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould update comments to empty string[33m 727[2mms[22m[39m
 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mInspection Statistics API[2m > [22mshould get defect trends[32m 233[2mms[22m[39m
 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mInspection Statistics API[2m > [22mshould get inspector performance metrics[32m 233[2mms[22m[39m
 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mInspection Statistics API[2m > [22mshould get checklist item statistics[32m 234[2mms[22m[39m
[90mstderr[2m | server/inspection-stats.test.ts[2m > [22m[2mError Tracking API[2m > [22m[2mshould log an error
[22m[39mError logged: {
  message: [32m'Test error message'[39m,
  stack: [32m'Error: Test error\\n    at test.ts:1:1'[39m,
  severity: [32m'error'[39m,
  category: [32m'backend'[39m,
  userId: [33m1[39m
}

 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mError Tracking API[2m > [22mshould log an error[32m 2[2mms[22m[39m
 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mError Tracking API[2m > [22mshould get error logs with filtering[32m 1[2mms[22m[39m
 [31mÃ—[39m server/inspection-stats.test.ts[2m > [22mError Tracking API[2m > [22mshould get error statistics[32m 5[2mms[22m[39m
[31m   â†’ expected { total: +0, bySeverity: {}, â€¦(1) } to have property "totalErrors"[39m
 [32mâœ“[39m server/inspection-stats.test.ts[2m > [22mError Tracking API[2m > [22mshould update error status[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould preserve comments when updating only result[33m 731[2mms[22m[39m
[90mstdout[2m | server/__tests__/inspection-notification.test.ts[2m > [22m[2mInspection Notification System
[22m[39m[Database] Connection pool created with limit: 10

 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould set default values correctly[33m 1879[2mms[22m[39m
[31m   â†’ expected undefined to be 'draft' // Object.is equality[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould update photoUrls and comments together[33m 484[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould handle special characters in comments[33m 484[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould create defect with valid data
[22m[39m2025-11-23T10:04:45.112Z ERROR [[object Object]] Failed to create defect

 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mgetStats[2m > [22mshould return inspection statistics[32m 241[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mupdateChecklistItemResult - Comments Field[2m > [22mshould handle newlines and tabs in comments[33m 484[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mgetStats[2m > [22mshould filter stats by projectId[32m 237[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mgetStats[2m > [22mshould calculate pass rate correctly[32m 238[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mgetChecklistItemResultById[2m > [22mshould retrieve item with all fields including comments[33m 485[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlist[2m > [22mshould return paginated inspection list[32m 244[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklistItemUpdate.test.ts[2m > [22mChecklist Item Update Tests - Comments Field[2m > [22mgetChecklistItemResultById[2m > [22mshould return null for non-existent item[32m 240[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlist[2m > [22mshould filter by search term[32m 237[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlist[2m > [22mshould filter by status[32m 238[2mms[22m[39m
 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould create defect with valid data[33m 3783[2mms[22m[39m
[31m   â†’ Failed to create defect. Please try again.[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlist[2m > [22mshould filter by projectId[32m 238[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlist[2m > [22mshould handle pagination correctly[33m 473[2mms[22m[39m
[90mstdout[2m | server/__tests__/checklistItemUpdate.test.ts[2m > [22m[2mChecklist Item Update Tests - Comments Field
[22m[39m[Database] Connection pool closed

 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlist[2m > [22mshould return empty array when no inspections match filters[32m 237[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection.test.ts[2m > [22mInspection Router[2m > [22mlistByProject[2m > [22mshould return inspections for a specific project[33m 467[2mms[22m[39m
[90mstdout[2m | server/__tests__/projects.test.ts[2m > [22m[2mProjects Router[2m > [22m[2mcreateProject[2m > [22m[2mshould create a new project successfully
[22m[39m[Database] Connection pool created with limit: 10

 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mInspection Procedures Integration Tests[2m > [22mtask.updateChecklistStatus[2m > [22mshould submit inspection with valid item results
 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mInspection Procedures Integration Tests[2m > [22mtask.updateChecklistStatus[2m > [22mshould reject inspection with invalid result value
 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mInspection Procedures Integration Tests[2m > [22mtask.updateChecklistStatus[2m > [22mshould reject inspection with empty item results
 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mInspection Procedures Integration Tests[2m > [22mtask.updateChecklistStatus[2m > [22mshould reject inspection with invalid template item ID
 [32mâœ“[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould validate required fields for defect[33m 3084[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection-notification.test.ts[2m > [22mInspection Notification System[2m > [22mshould have notificationSent and notifiedAt fields in schema[32m 245[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection-notification.test.ts[2m > [22mInspection Notification System[2m > [22mshould update notificationSent flag when inspection fails[33m 484[2mms[22m[39m
 [31mÃ—[39m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.create[2m > [22mshould create defect with valid input[32m 2[2mms[22m[39m
[31m   â†’ [
  {
    "expected": "number",
    "code": "invalid_type",
    "path": [
      "projectId"
    ],
    "message": "Invalid input: expected number, received undefined"
  }
][39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.create[2m > [22mshould reject defect creation with empty title[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.create[2m > [22mshould reject defect creation with invalid severity[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.create[2m > [22mshould reject defect creation with invalid task ID[32m 0[2mms[22m[39m
 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.update[2m > [22mshould update defect with valid data
[90mstdout[2m | server/__tests__/escalation.test.ts[2m > [22m[2mEscalation System
[22m[39m[Database] Connection pool created with limit: 10

 [32mâœ“[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mcreateProject[2m > [22mshould create a new project successfully[33m 2524[2mms[22m[39m
 [32mâœ“[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mcreateProject[2m > [22mshould fail to create project without required fields[32m 3[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection-notification.test.ts[2m > [22mInspection Notification System[2m > [22mshould send notification to task assignee when inspection fails[33m 725[2mms[22m[39m
 [32mâœ“[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mgetProjectById[2m > [22mshould retrieve project by ID[32m 240[2mms[22m[39m
 [32mâœ“[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mgetProjectById[2m > [22mshould return null for non-existent project[32m 234[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection-notification.test.ts[2m > [22mInspection Notification System[2m > [22mshould send notification to project manager when inspection fails[33m 481[2mms[22m[39m
 [32mâœ“[39m server/__tests__/inspection-notification.test.ts[2m > [22mInspection Notification System[2m > [22mshould not send duplicate notifications[32m 240[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould set default status to reported
[22m[39m2025-11-23T10:04:52.035Z ERROR [[object Object]] Failed to create defect

 [32mâœ“[39m server/__tests__/inspection-notification.test.ts[2m > [22mInspection Notification System[2m > [22mshould store notification timestamp correctly[32m 240[2mms[22m[39m
 [31mÃ—[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mlistProjects[2m > [22mshould list all projects with pagination[33m 720[2mms[22m[39m
[31m   â†’ expected 25 to be 10 // Object.is equality[39m
 [32mâœ“[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mlistProjects[2m > [22mshould filter projects by status[32m 240[2mms[22m[39m
 [31mÃ—[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mupdateProject[2m > [22mshould update project successfully[33m 477[2mms[22m[39m
[31m   â†’ Cannot read properties of undefined (reading 'x-forwarded-for')[39m
 [32mâœ“[39m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mgetProjectStats[2m > [22mshould return project statistics[33m 469[2mms[22m[39m
 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould set default status to reported[33m 3828[2mms[22m[39m
[31m   â†’ Failed to create defect. Please try again.[39m
 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Rules Management[2m > [22mshould create escalation rule[33m 1627[2mms[22m[39m
 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.update[2m > [22mshould reject update with invalid status
 [2m[90mâ†“[39m[22m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.update[2m > [22mshould reject update with invalid severity
 [32mâœ“[39m server/routers.test.ts[2m > [22mType Safety Tests[2m > [22mshould enforce type safety for task status[32m 1[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mType Safety Tests[2m > [22mshould enforce type safety for task priority[32m 0[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mType Safety Tests[2m > [22mshould enforce type safety for defect severity[32m 0[2mms[22m[39m
 [32mâœ“[39m server/routers.test.ts[2m > [22mType Safety Tests[2m > [22mshould enforce type safety for checklist result[32m 0[2mms[22m[39m
[90mstdout[2m | server/__tests__/projects-simple.test.ts[2m > [22m[2mProjects Router - Simple Tests[2m > [22m[2mlist procedure[2m > [22m[2mshould return paginated projects list
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/db.test.ts[2m > [22m[2mTask Management[2m > [22m[2mcreateTask[2m > [22m[2mshould create a task with valid data
[22m[39m[Database] Connection pool created with limit: 10

 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mcreateTask[2m > [22mshould create task with transaction[32m 4[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mcreateTask[2m > [22mshould convert BigInt insertId to number[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mcreateTask[2m > [22mshould handle Date conversion for startDate/endDate[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mdeleteTask[2m > [22mshould delete task with all related data in transaction[32m 4[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mdeleteTask[2m > [22mshould handle BigInt taskId conversion[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mupdateTask[2m > [22mshould update task in transaction[32m 1[2mms[22m[39m
 [32mâœ“[39m server/services/__tests__/task.service.test.ts[2m > [22mTask Service[2m > [22mTransaction Rollback[2m > [22mshould rollback on error[32m 2[2mms[22m[39m
 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mCSRF Protection[2m > [22mshould reject requests without CSRF token[32m 94[2mms[22m[39m
 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mCSRF Protection[2m > [22mshould accept requests with valid CSRF token[32m 5[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould validate project and task existence
[22m[39m2025-11-23T10:04:55.575Z ERROR [[object Object]] Failed to create defect

 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mRate Limiting[2m > [22mshould enforce rate limits on API endpoints[32m 274[2mms[22m[39m
 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mRate Limiting[2m > [22mshould have stricter limits on upload endpoints[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mInput Validation[2m > [22mshould validate file upload types[32m 4[2mms[22m[39m
 [31mÃ—[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mInput Validation[2m > [22mshould validate file upload size[32m 64[2mms[22m[39m
[31m   â†’ expected [ 400, 413 ] to include 403[39m
 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mVirus Scanning[2m > [22mshould have virus scanning available[32m 3[2mms[22m[39m
 [32mâœ“[39m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mAuthentication Security[2m > [22mshould protect API endpoints from unauthorized access[32m 5[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould validate project and task existence
[22m[39m2025-11-23T10:04:55.808Z ERROR [[object Object]] Failed to create defect

 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Rules Management[2m > [22mshould list all escalation rules[33m 1827[2mms[22m[39m
 [32mâœ“[39m server/db.test.ts[2m > [22mTask Management[2m > [22mcreateTask[2m > [22mshould create a task with valid data[33m 1445[2mms[22m[39m
 [32mâœ“[39m server/db.test.ts[2m > [22mTask Management[2m > [22mcreateTask[2m > [22mshould convert string dates to Date objects[32m 233[2mms[22m[39m
[90mstdout[2m | tests/checklist-item-update.test.ts[2m > [22m[2mChecklist Item Update
[22m[39m[Database] Connection pool created with limit: 10

 [32mâœ“[39m server/db.test.ts[2m > [22mTask Management[2m > [22mcreateTask[2m > [22mshould handle missing optional fields[32m 233[2mms[22m[39m
 [32mâœ“[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould validate project and task existence[33m 3775[2mms[22m[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mDefect Management[2m > [22mcreateDefect[2m > [22mshould create a defect with valid data[32m 248[2mms[22m[39m
[31m   â†’ Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, ?, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 1,Test Defect,Test Description,reported,high,1,CAR[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mDefect Management[2m > [22mcreateDefect[2m > [22mshould set default status to 'reported'[32m 231[2mms[22m[39m
[31m   â†’ Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 1,Test Defect,reported,medium,1,CAR[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould submit inspection with all passed items[32m 1[2mms[22m[39m
[31m   â†’ [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould create defects for failed items[32m 0[2mms[22m[39m
[31m   â†’ [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould set overall status to 'failed' when any item fails[32m 0[2mms[22m[39m
[31m   â†’ [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould set overall status to 'completed' when all items pass[32m 1[2mms[22m[39m
[31m   â†’ [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mTask Status Management[2m > [22mupdateTaskStatus[2m > [22mshould update task status[32m 1[2mms[22m[39m
[31m   â†’ [vitest] No "updateTaskStatus" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [31mÃ—[39m server/db.test.ts[2m > [22mTask Status Management[2m > [22mupdateTaskStatus[2m > [22mshould handle all valid status values[32m 0[2mms[22m[39m
[31m   â†’ [vitest] No "updateTaskStatus" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
 [31mÃ—[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mlist procedure[2m > [22mshould return paginated projects list[33m 1950[2mms[22m[39m
[31m   â†’ expected 25 to be 10 // Object.is equality[39m
 [32mâœ“[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mlist procedure[2m > [22mshould handle pagination correctly[33m 706[2mms[22m[39m
 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Rules Management[2m > [22mshould get escalation rule by ID[33m 1828[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateTaskChecklist - Checklist Creation Transaction[2m > [22m[2mshould create task checklist with valid data
[22m[39m2025-11-23T10:04:58.414Z ERROR  [ERROR] Task create failed
{
  "code": "BAD_REQUEST",
  "name": "TRPCError"
}

 [31mÃ—[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mget procedure[2m > [22mshould return null for non-existent project[32m 233[2mms[22m[39m
[31m   â†’ expected undefined to be null[39m
 [32mâœ“[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mget procedure[2m > [22mshould return project if exists[33m 946[2mms[22m[39m
[90mstdout[2m | server/__tests__/checklist-pending-count.test.ts[2m > [22m[2mChecklist Pending Count
[22m[39m[Database] Connection pool created with limit: 10

 [32mâœ“[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mgetNextProjectCode procedure[2m > [22mshould return a valid project code[32m 233[2mms[22m[39m
 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould create task checklist with valid data[33m 1893[2mms[22m[39m
[31m   â†’ status: Invalid task status: pending_pre_inspection[39m
 [32mâœ“[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mcreate procedure[2m > [22mshould create a new project[33m 1167[2mms[22m[39m
 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Rules Management[2m > [22mshould update escalation rule[33m 2285[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateTaskChecklist - Checklist Creation Transaction[2m > [22m[2mshould validate task existence
[22m[39m2025-11-23T10:05:00.329Z ERROR  [ERROR] Task create failed
{
  "code": "BAD_REQUEST",
  "name": "TRPCError"
}

 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Logs[2m > [22mshould list escalation logs[32m 232[2mms[22m[39m
 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Logs[2m > [22mshould filter escalation logs by resolved status[32m 229[2mms[22m[39m
 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mEscalation Statistics[2m > [22mshould get escalation statistics[32m 226[2mms[22m[39m
[90mstdout[2m | server/__tests__/escalation.test.ts[2m > [22m[2mEscalation System[2m > [22m[2mManual Escalation Trigger[2m > [22m[2mshould manually trigger escalation check
[22m[39m2025-11-23T10:05:01.169Z INFO  [Escalation] No active escalation rules found

 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mManual Escalation Trigger[2m > [22mshould manually trigger escalation check[33m 456[2mms[22m[39m
 [32mâœ“[39m server/__tests__/escalation.test.ts[2m > [22mEscalation System[2m > [22mPermission Checks[2m > [22mshould deny access to non-admin users[32m 2[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mValid conversions[2m > [22mshould convert small BigInt to number[32m 1[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mValid conversions[2m > [22mshould convert large BigInt to number[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mValid conversions[2m > [22mshould return number as-is[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mValid conversions[2m > [22mshould handle zero[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mValid conversions[2m > [22mshould handle negative numbers[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mValid conversions[2m > [22mshould handle MAX_SAFE_INTEGER[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mError handling[2m > [22mshould throw error for BigInt exceeding MAX_SAFE_INTEGER[32m 1[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mError handling[2m > [22mshould throw error for very large BigInt[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mError handling[2m > [22mshould include the BigInt value in error message[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mMySQL insertId scenarios[2m > [22mshould handle typical MySQL insertId[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mMySQL insertId scenarios[2m > [22mshould handle auto-increment IDs up to millions[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mMySQL insertId scenarios[2m > [22mshould handle sequential IDs[32m 1[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mEdge cases[2m > [22mshould handle 1[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mEdge cases[2m > [22mshould handle -1[32m 0[2mms[22m[39m
 [32mâœ“[39m server/utils/__tests__/bigint.test.ts[2m > [22mbigIntToNumber[2m > [22mEdge cases[2m > [22mshould be idempotent for numbers[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mcreate procedure[2m > [22mshould fail with invalid data[32m 3[2mms[22m[39m
 [31mÃ—[39m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mupdate procedure[2m > [22mshould update an existing project[33m 1640[2mms[22m[39m
[31m   â†’ Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateTaskChecklist - Checklist Creation Transaction[2m > [22m[2mshould validate template existence
[22m[39m2025-11-23T10:05:02.209Z ERROR  [ERROR] Task create failed
{
  "code": "BAD_REQUEST",
  "name": "TRPCError"
}

 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould validate task existence[33m 1911[2mms[22m[39m
[31m   â†’ status: Invalid task status: pending_pre_inspection[39m
[90mstdout[2m | server/__tests__/rbac.test.ts[2m > [22m[2mRBAC Authorization Tests[2m > [22m[2mAuthorization Functions Return Boolean[2m > [22m[2mcanEditProject should return boolean for invalid inputs
[22m[39m[Database] Connection pool created with limit: 10

 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have canEditProject function[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have canDeleteProject function[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have canEditTask function[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have canDeleteTask function[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have canEditDefect function[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have canDeleteDefect function[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Exist[2m > [22mshould have isProjectManager function[32m 0[2mms[22m[39m
[90mstdout[2m | server/__tests__/project-delete.test.ts[2m > [22m[2mProject Delete
[22m[39m[Database] Connection pool created with limit: 10

 [31mÃ—[39m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould update checklist item result[32m 4[2mms[22m[39m
[31m   â†’ No procedure found on path "inspection,updateChecklistItem"[39m
 [31mÃ—[39m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould update only result without comments[32m 1[2mms[22m[39m
[31m   â†’ No procedure found on path "inspection,updateChecklistItem"[39m
 [32mâœ“[39m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould throw error for non-existent item[32m 2[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22mcanEditProject should return boolean for invalid inputs[33m 1460[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22mcanDeleteProject should return boolean for invalid inputs[32m 235[2mms[22m[39m
[90mstderr[2m | server/__tests__/rbac.test.ts[2m > [22m[2mRBAC Authorization Tests[2m > [22m[2mAuthorization Functions Return Boolean[2m > [22m[2mcanEditTask should return boolean for invalid inputs
[22m[39m2025-11-23T10:05:03.918Z ERROR [[object Object]] [RBAC] canEditTask failed
{}

[90mstderr[2m | server/__tests__/rbac.test.ts[2m > [22m[2mRBAC Authorization Tests[2m > [22m[2mAuthorization Functions Return Boolean[2m > [22m[2mcanDeleteTask should return boolean for invalid inputs
[22m[39m2025-11-23T10:05:03.920Z ERROR [[object Object]] [RBAC] canDeleteTask failed
{}

[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateTaskChecklist - Checklist Creation Transaction[2m > [22m[2mshould prevent duplicate checklists for same task and stage
[22m[39m2025-11-23T10:05:04.088Z ERROR  [ERROR] Task create failed
{
  "code": "BAD_REQUEST",
  "name": "TRPCError"
}

 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould validate template existence[33m 1881[2mms[22m[39m
[31m   â†’ status: Invalid task status: pending_pre_inspection[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22mcanEditTask should return boolean for invalid inputs[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22mcanDeleteTask should return boolean for invalid inputs[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22mcanEditDefect should return boolean for invalid inputs[32m 234[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22mcanDeleteDefect should return boolean for invalid inputs[32m 233[2mms[22m[39m
 [32mâœ“[39m server/__tests__/rbac.test.ts[2m > [22mRBAC Authorization Tests[2m > [22mAuthorization Functions Return Boolean[2m > [22misProjectManager should return boolean for invalid inputs[32m 234[2mms[22m[39m
 [2m[90mâ†“[39m[22m server/__tests__/project-delete.test.ts[2m > [22mProject Delete[2m > [22mshould allow admin to delete project
 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould prevent duplicate checklists for same task and stage[33m 1880[2mms[22m[39m
[31m   â†’ status: Invalid task status: pending_pre_inspection[39m
 [2m[90mâ†“[39m[22m server/__tests__/project-delete.test.ts[2m > [22mProject Delete[2m > [22mshould prevent non-admin from deleting project
 [2m[90mâ†“[39m[22m server/__tests__/project-delete.test.ts[2m > [22mProject Delete[2m > [22mshould return error when deleting non-existent project
 [32mâœ“[39m server/__tests__/logger.test.ts[2m > [22mLogger Utility[2m > [22mshould log info messages[32m 3[2mms[22m[39m
 [32mâœ“[39m server/__tests__/logger.test.ts[2m > [22mLogger Utility[2m > [22mshould log warning messages[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/logger.test.ts[2m > [22mLogger Utility[2m > [22mshould log error messages[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/logger.test.ts[2m > [22mLogger Utility[2m > [22mshould include context in log messages[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/logger.test.ts[2m > [22mLogger Utility[2m > [22mshould include data in log messages[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/logger.test.ts[2m > [22mLogger Utility[2m > [22mshould format timestamp correctly[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/routers.test.ts[2m > [22mtRPC Context[2m > [22mshould create context with user[32m 1[2mms[22m[39m
 [32mâœ“[39m server/__tests__/routers.test.ts[2m > [22mtRPC Context[2m > [22mshould create context without user (public)[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/routers.test.ts[2m > [22mtRPC Context[2m > [22mshould distinguish between user roles[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/routers.test.ts[2m > [22mAuthentication Flow[2m > [22mshould validate user object structure[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/routers.test.ts[2m > [22mAuthentication Flow[2m > [22mshould handle admin permissions[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/routers.test.ts[2m > [22mAuthentication Flow[2m > [22mshould handle regular user permissions[32m 0[2mms[22m[39m
[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection[2m > [22m[2mshould establish database connection
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection[2m > [22m[2mshould close connection gracefully
[22m[39m[Database] Connection pool closed

[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection[2m > [22m[2mshould close connection gracefully
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection
[22m[39m[Database] Connection pool closed

 [32mâœ“[39m server/__tests__/db.test.ts[2m > [22mDatabase Connection[2m > [22mshould establish database connection[32m 4[2mms[22m[39m
 [32mâœ“[39m server/__tests__/db.test.ts[2m > [22mDatabase Connection[2m > [22mshould return the same instance on multiple calls[32m 0[2mms[22m[39m
 [32mâœ“[39m server/__tests__/db.test.ts[2m > [22mDatabase Connection[2m > [22mshould close connection gracefully[32m 1[2mms[22m[39m
[90mstdout[2m | server/test-template-create.test.ts[2m > [22m[2mTemplates Router[2m > [22m[2mshould have templates.create mutation
[22m[39mtemplates.create mutation exists

 [32mâœ“[39m server/test-template-create.test.ts[2m > [22mTemplates Router[2m > [22mshould have templates.create mutation[32m 3[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mDatabase Integrity Tests[2m > [22m[2mshould maintain referential integrity on project deletion
[22m[39m2025-11-23T10:05:07.142Z ERROR [[object Object]] Failed to create defect

 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mDatabase Integrity Tests[2m > [22mshould maintain referential integrity on project deletion[33m 2347[2mms[22m[39m
[31m   â†’ Failed to create defect. Please try again.[39m
 [32mâœ“[39m server/__tests__/checklist-pending-count.test.ts[2m > [22mChecklist Pending Count[2m > [22mshould count pending and in_progress checklists correctly[33m 4290[2mms[22m[39m
 [32mâœ“[39m server/__tests__/checklist-pending-count.test.ts[2m > [22mChecklist Pending Count[2m > [22mshould return 0 when no pending checklists exist[33m 1585[2mms[22m[39m
 [31mÃ—[39m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mDatabase Integrity Tests[2m > [22mshould handle concurrent updates correctly[33m 2364[2mms[22m[39m
[31m   â†’ Cannot read properties of undefined (reading 'x-forwarded-for')[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Suites 8 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mInspection Procedures Integration Tests
[31m[1mTypeError[22m: __vite_ssr_import_2__.createChecklistTemplateItem is not a function[39m
[36m [2mâ¯[22m server/routers.test.ts:[2m249:14[22m[39m
    [90m247| [39m
    [90m248| [39m    [90m// Add template items[39m
    [90m249| [39m    [35mawait[39m db[33m.[39m[34mcreateChecklistTemplateItem[39m({
    [90m   | [39m             [31m^[39m
    [90m250| [39m      templateId[33m:[39m testTemplateId[33m,[39m
    [90m251| [39m      itemNumber[33m:[39m [34m1[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.update
[31m[1mError[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 510009,Defect for Update Tests,reported,medium,1,CAR[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m Module.createDefect server/db.ts:[2m1558:10[22m[39m
    [90m1556| [39m  if (!db) throw new Error("Database not available");
    [90m1557| [39m
    [90m1558| [39m  return await db.insert(defects).values({
    [90m   | [39m         [31m^[39m
    [90m1559| [39m    taskId: data.taskId,
    [90m1560| [39m    checklistItemResultId: data.checklistItemResultId,
[90m [2mâ¯[22m server/routers.test.ts:[2m444:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', params: [ 510009, 'Defect for Update Tests', 'reported', 'medium', 1, 'CAR' ] }[39m
[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 510009, default, \'Defect for Update Tests\', default, default, \'reported\', \'medium\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/project-delete.test.ts[2m > [22mProject Delete
[31m[1mError[22m: Failed query: insert into `projectMembers` (`id`, `projectId`, `userId`, `role`, `createdAt`) values (default, ?, ?, ?, default)
params: 540024,9999,project_manager[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/db.ts:[2m327:5[22m[39m
    [90m325| [39m
    [90m326| [39m    // Insert project member (creator as project manager)
    [90m327| [39m    await tx.insert(projectMembers).values({
    [90m   | [39m    [31m^[39m
    [90m328| [39m      projectId,
    [90m329| [39m      userId: data.createdBy,
[90m [2mâ¯[22m MySql2Session.transaction node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m207:22[22m[39m
[90m [2mâ¯[22m Module.createProject server/db.ts:[2m299:10[22m[39m
[90m [2mâ¯[22m server/__tests__/project-delete.test.ts:[2m47:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projectMembers` (`id`, `projectId`, `userId`, `role`, `createdAt`) values (default, ?, ?, ?, default)', params: [ 540024, 9999, 'project_manager' ] }[39m
[31m[1mCaused by: Error[22m: Cannot add or update a child row: a foreign key constraint fails (`xgufrkfw3wtjbzrcqsfjbu`.`projectmembers`, CONSTRAINT `fk_projectMembers_userId` FOREIGN KEY (`userId`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)[39m
[90m [2mâ¯[22m PromisePoolConnection.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/connection.js:[2m29:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_REFERENCED_ROW_2', errno: 1452, sql: 'insert into `projectMembers` (`id`, `projectId`, `userId`, `role`, `createdAt`) values (default, 540024, 9999, \'project_manager\', default)', sqlState: '23000', sqlMessage: 'Cannot add or update a child row: a foreign key constraint fails (`xgufrkfw3wtjbzrcqsfjbu`.`projectmembers`, CONSTRAINT `fk_projectMembers_userId` FOREIGN KEY (`userId`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects.test.ts[2m > [22mProjects Router
[31m[1mError[22m: Failed query: delete from `projects` where ?
params: (t) => t.id.eq(testProjectId)[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/projects.test.ts:[2m48:9[22m[39m
    [90m 46| [39m      [35mif[39m (db) {
    [90m 47| [39m        [35mconst[39m { projects } [33m=[39m [35mawait[39m [35mimport[39m([32m'../../drizzle/schema'[39m)[33m;[39m
    [90m 48| [39m        await db.delete(projects).where((t: any) => t.id.eq(testProjecâ€¦
    [90m   | [39m        [31m^[39m
    [90m 49| [39m      }
    [90m 50| [39m    }

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'delete from `projects` where ?', params: [ 'Function<anonymous>' ] }[39m
[31m[1mCaused by: Error[22m: Truncated incorrect DOUBLE value: '?'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/delete.js:[2m91:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_TRUNCATED_WRONG_VALUE', errno: 1292, sql: 'delete from `projects` where \'(t) => t.id.eq(testProjectId)\'', sqlState: '22007', sqlMessage: 'Truncated incorrect DOUBLE value: \'?\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/e2e/auth.spec.ts[2m [ tests/e2e/auth.spec.ts ][22m
[31m[1mError[22m: Playwright Test did not expect test.describe() to be called here.
Most common reasons include:
- You are calling test.describe() in a configuration file.
- You are calling test.describe() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.[39m
[90m [2mâ¯[22m TestTypeImpl._currentSuite node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m74:13[22m[39m
[90m [2mâ¯[22m TestTypeImpl._describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m114:24[22m[39m
[90m [2mâ¯[22m Function.describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/transform/transform.js:[2m275:12[22m[39m
[36m [2mâ¯[22m tests/e2e/auth.spec.ts:[2m13:6[22m[39m
    [90m 11| [39m */[39m
    [90m 12| [39m
    [90m 13| [39mtest[33m.[39m[34mdescribe[39m([32m'Authentication Flow'[39m[33m,[39m () [33m=>[39m {
    [90m   | [39m     [31m^[39m
    [90m 14| [39m  test('should redirect to login when accessing protected page', asyncâ€¦
    [90m 15| [39m    [90m// Navigate to dashboard (protected page)[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/e2e/inspection.spec.ts[2m [ tests/e2e/inspection.spec.ts ][22m
[31m[1mError[22m: Playwright Test did not expect test.describe() to be called here.
Most common reasons include:
- You are calling test.describe() in a configuration file.
- You are calling test.describe() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.[39m
[90m [2mâ¯[22m TestTypeImpl._currentSuite node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m74:13[22m[39m
[90m [2mâ¯[22m TestTypeImpl._describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m114:24[22m[39m
[90m [2mâ¯[22m Function.describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/transform/transform.js:[2m275:12[22m[39m
[36m [2mâ¯[22m tests/e2e/inspection.spec.ts:[2m13:6[22m[39m
    [90m 11| [39m */[39m
    [90m 12| [39m
    [90m 13| [39mtest[33m.[39m[34mdescribe[39m([32m'QC Inspection Workflow'[39m[33m,[39m () [33m=>[39m {
    [90m   | [39m     [31m^[39m
    [90m 14| [39m  test[33m.[39m[34mbeforeEach[39m([35masync[39m ({ page }) [33m=>[39m {
    [90m 15| [39m    [90m// Note: These tests require authentication[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'templateId')[39m
[36m [2mâ¯[22m server/__tests__/integration/checklist-completion-flow.test.ts:[2m145:65[22m[39m
    [90m143| [39m    [35mif[39m ([33m![39mtestDb) [35mreturn[39m[33m;[39m
    [90m144| [39m
    [90m145| [39m    await testDb.delete(checklistItems).where(eq(checklistItems.templaâ€¦
    [90m   | [39m                                                                [31m^[39m
    [90m146| [39m    await testDb.delete(checklistInstances).where(eq(checklistInstanceâ€¦
    [90m147| [39m    await testDb.delete(checklistTemplates).where(eq(checklistTemplateâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'projectId')[39m
[36m [2mâ¯[22m server/__tests__/integration/defect-escalation-flow.test.ts:[2m87:71[22m[39m
    [90m 85| [39m    [35mif[39m ([33m![39mtestDb) [35mreturn[39m[33m;[39m
    [90m 86| [39m
    [90m 87| [39m    await testDb.delete(escalationHistory).where(eq(escalationHistory.â€¦
    [90m   | [39m                                                                      [31m^[39m
    [90m 88| [39m    await testDb.delete(defects).where(eq(defects.projectId, projectIdâ€¦
    [90m 89| [39m    await testDb.delete(projectMembers).where(eq(projectMembers.projecâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/46]âŽ¯[22m[39m


[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 38 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mDefect Management[2m > [22mcreateDefect[2m > [22mshould create a defect with valid data
[31m[1mError[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, ?, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 1,Test Defect,Test Description,reported,high,1,CAR[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m Proxy.createDefect server/db.ts:[2m1558:10[22m[39m
    [90m1556| [39m  if (!db) throw new Error("Database not available");
    [90m1557| [39m
    [90m1558| [39m  return await db.insert(defects).values({
    [90m   | [39m         [31m^[39m
    [90m1559| [39m    taskId: data.taskId,
    [90m1560| [39m    checklistItemResultId: data.checklistItemResultId,
[90m [2mâ¯[22m server/db.test.ts:[2m91:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, ?, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', params: [ 1, 'Test Defect', 'Test Description', 'reported', 'high', 1, 'CAR' ] }[39m
[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 1, default, \'Test Defect\', \'Test Description\', default, \'reported\', \'high\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mDefect Management[2m > [22mcreateDefect[2m > [22mshould set default status to 'reported'
[31m[1mError[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 1,Test Defect,reported,medium,1,CAR[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m Proxy.createDefect server/db.ts:[2m1558:10[22m[39m
    [90m1556| [39m  if (!db) throw new Error("Database not available");
    [90m1557| [39m
    [90m1558| [39m  return await db.insert(defects).values({
    [90m   | [39m         [31m^[39m
    [90m1559| [39m    taskId: data.taskId,
    [90m1560| [39m    checklistItemResultId: data.checklistItemResultId,
[90m [2mâ¯[22m server/db.test.ts:[2m103:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', params: [ 1, 'Test Defect', 'reported', 'medium', 1, 'CAR' ] }[39m
[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 1, default, \'Test Defect\', default, default, \'reported\', \'medium\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould submit inspection with all passed items
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2mâ¯[22m server/db.test.ts:[2m124:28[22m[39m
    [90m122| [39m      }[33m;[39m
    [90m123| [39m
    [90m124| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m125| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m126| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould create defects for failed items
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2mâ¯[22m server/db.test.ts:[2m141:28[22m[39m
    [90m139| [39m      }[33m;[39m
    [90m140| [39m
    [90m141| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m142| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m143| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould set overall status to 'failed' when any item fails
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2mâ¯[22m server/db.test.ts:[2m157:28[22m[39m
    [90m155| [39m      }[33m;[39m
    [90m156| [39m
    [90m157| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m158| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m159| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould set overall status to 'completed' when all items pass
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2mâ¯[22m server/db.test.ts:[2m174:28[22m[39m
    [90m172| [39m      }[33m;[39m
    [90m173| [39m
    [90m174| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m175| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m176| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mTask Status Management[2m > [22mupdateTaskStatus[2m > [22mshould update task status
[31m[1mError[22m: [vitest] No "updateTaskStatus" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2mâ¯[22m server/db.test.ts:[2m183:28[22m[39m
    [90m181| [39m  [34mdescribe[39m([32m"updateTaskStatus"[39m[33m,[39m () [33m=>[39m {
    [90m182| [39m    [34mit[39m([32m"should update task status"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m183| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mupdateTaskStatus[39m([34m1[39m[33m,[39m [32m"in_progress"[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m184| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m185| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mTask Status Management[2m > [22mupdateTaskStatus[2m > [22mshould handle all valid status values
[31m[1mError[22m: [vitest] No "updateTaskStatus" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2mâ¯[22m server/db.test.ts:[2m191:30[22m[39m
    [90m189| [39m      
    [90m190| [39m      [35mfor[39m ([35mconst[39m status [35mof[39m statuses) {
    [90m191| [39m        [35mconst[39m result [33m=[39m [35mawait[39m [34mupdateTaskStatus[39m([34m1[39m[33m,[39m status)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m192| [39m        [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m193| [39m      }

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/inspection-stats.test.ts[2m > [22mError Tracking API[2m > [22mshould get error statistics
[31m[1mAssertionError[22m: expected { total: +0, bySeverity: {}, â€¦(1) } to have property "totalErrors"[39m
[36m [2mâ¯[22m server/inspection-stats.test.ts:[2m173:20[22m[39m
    [90m171| [39m    
    [90m172| [39m    [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m173| [39m    [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"totalErrors"[39m)[33m;[39m
    [90m   | [39m                   [31m^[39m
    [90m174| [39m    [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"criticalErrors"[39m)[33m;[39m
    [90m175| [39m    [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"unresolvedErrors"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.update[2m > [22mshould update task with valid data
[31m[1mTRPCError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
    [90m199| [39m[35mexport[39m [35mfunction[39m [34mgetClientIp[39m(req[33m:[39m any)[33m:[39m string [33m|[39m undefined {
    [90m200| [39m  [35mreturn[39m (
    [90m201| [39m    req[33m.[39mheaders[[32m'x-forwarded-for'[39m][33m?.[39m[34msplit[39m([32m','[39m)[[34m0[39m][33m?.[39m[34mtrim[39m() [33m||[39m
    [90m   | [39m        [31m^[39m
    [90m202| [39m    req[33m.[39mheaders[[32m'x-real-ip'[39m] [33m||[39m
    [90m203| [39m    req[33m.[39msocket[33m?.[39mremoteAddress [33m||[39m
[90m [2mâ¯[22m server/routers/taskRouter.ts:[2m194:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/routers.test.ts:[2m171:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: TypeError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
[90m [2mâ¯[22m server/routers/taskRouter.ts:[2m194:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/routers.test.ts:[2m171:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.create[2m > [22mshould create defect with valid input
[31m[1mTRPCError[22m: [
  {
    "expected": "number",
    "code": "invalid_type",
    "path": [
      "projectId"
    ],
    "message": "Invalid input: expected number, received undefined"
  }
][39m
[90m [2mâ¯[22m inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m44:10[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[36m [2mâ¯[22m server/routers.test.ts:[2m387:22[22m[39m
    [90m385| [39m      const caller = createCaller(createTestContext(testUserId, 'adminâ€¦
    [90m386| [39m
    [90m387| [39m      [35mconst[39m result [33m=[39m [35mawait[39m caller[33m.[39mdefect[33m.[39m[34mcreate[39m({
    [90m   | [39m                     [31m^[39m
    [90m388| [39m        title[33m:[39m [32m'Test Defect'[39m[33m,[39m
    [90m389| [39m        description[33m:[39m [32m'Test defect description'[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'BAD_REQUEST' }[39m
[31m[1mCaused by: ZodError[22m: [
  {
    "expected": "number",
    "code": "invalid_type",
    "path": [
      "projectId"
    ],
    "message": "Invalid input: expected number, received undefined"
  }
][39m
[90m [2mâ¯[22m inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m42:24[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ _zod: { traits: { constructor: 'Function<Set>', has: 'Function<has>', add: 'Function<add>', delete: 'Function<delete>', clear: 'Function<clear>', entries: 'Function<entries>', forEach: 'Function<forEach>', size: 2, values: 'Function<values>', keys: 'Function<values>', union: 'Function<union>', intersection: 'Function<intersection>', difference: 'Function<difference>', symmetricDifference: 'Function<symmetricDifference>', isSubsetOf: 'Function<isSubsetOf>', isSupersetOf: 'Function<isSupersetOf>', isDisjointFrom: 'Function<isDisjointFrom>' }, constr: 'Function<ZodError>', def: [ { expected: 'number', code: 'invalid_type', path: [ 'projectId' ], message: 'Invalid input: expected number, received undefined' } ], deferred: [] }, issues: [ { expected: 'number', code: 'invalid_type', path: [ 'projectId' ], message: 'Invalid input: expected number, received undefined' } ], format: 'Function<value>', flatten: 'Function<value>', addIssue: 'Function<value>', addIssues: 'Function<value>', isEmpty: false }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould update checklist item result
[31m[1mTRPCError[22m: No procedure found on path "inspection,updateChecklistItem"[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m293:28[22m[39m
[36m [2mâ¯[22m tests/checklist-item-update.test.ts:[2m94:20[22m[39m
    [90m 92| [39m    })[33m;[39m
    [90m 93| [39m
    [90m 94| [39m    [35mconst[39m result [33m=[39m [35mawait[39m caller[33m.[39minspection[33m.[39m[34mupdateChecklistItem[39m({
    [90m   | [39m                   [31m^[39m
    [90m 95| [39m      itemResultId[33m:[39m testItemResult[33m.[39mid[33m,[39m
    [90m 96| [39m      result[33m:[39m [32m"fail"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'NOT_FOUND' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould update only result without comments
[31m[1mTRPCError[22m: No procedure found on path "inspection,updateChecklistItem"[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m293:28[22m[39m
[36m [2mâ¯[22m tests/checklist-item-update.test.ts:[2m115:5[22m[39m
    [90m113| [39m    })[33m;[39m
    [90m114| [39m
    [90m115| [39m    [35mawait[39m caller[33m.[39minspection[33m.[39m[34mupdateChecklistItem[39m({
    [90m   | [39m    [31m^[39m
    [90m116| [39m      itemResultId[33m:[39m testItemResult[33m.[39mid[33m,[39m
    [90m117| [39m      result[33m:[39m [32m"na"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'NOT_FOUND' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould create project with valid data
[31m[1mAssertionError[22m: expected undefined to be 'Test Project - Critical Transaction' // Object.is equality[39m

[32m- Expected:[39m 
"Test Project - Critical Transaction"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m118:27[22m[39m
    [90m116| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m117| [39m      [34mexpect[39m(result[33m.[39mid)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m118| [39m      [34mexpect[39m(result[33m.[39mname)[33m.[39m[34mtoBe[39m(projectData[33m.[39mname)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m119| [39m      [34mexpect[39m(result[33m.[39mcode)[33m.[39m[34mtoBe[39m(projectData[33m.[39mcode)[33m;[39m
    [90m120| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m(projectData[33m.[39mstatus)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould prevent duplicate project codes
[31m[1mAssertionError[22m: promise resolved "{ success: true, id: 540004 }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Error {[39m
[32m-   "message": "rejected promise",[39m
[31m+ {[39m
[31m+   "id": 540004,[39m
[31m+   "success": true,[39m
[2m  }[22m

[36m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m173:7[22m[39m
    [90m171| [39m          status[33m:[39m [32m'planning'[39m [35mas[39m [35mconst[39m[33m,[39m
    [90m172| [39m        })
    [90m173| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m174| [39m    })[33m;[39m
    [90m175| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould set default values correctly
[31m[1mAssertionError[22m: expected undefined to be 'draft' // Object.is equality[39m

[32m- Expected:[39m 
"draft"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m186:29[22m[39m
    [90m184| [39m      testProjectId [33m=[39m result[33m.[39mid[33m;[39m
    [90m185| [39m
    [90m186| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'draft'[39m)[33m;[39m [90m// Default status[39m
    [90m   | [39m                            [31m^[39m
    [90m187| [39m      [34mexpect[39m(result[33m.[39mcompletionPercentage)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m188| [39m      [34mexpect[39m(result[33m.[39mcreatedBy)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould create defect with valid data
[31m[1mTRPCError[22m: Failed to create defect. Please try again.[39m
[36m [2mâ¯[22m server/routers/defectRouter.ts:[2m232:15[22m[39m
    [90m230| [39m
    [90m231| [39m        [90m// Wrap other errors[39m
    [90m232| [39m        [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m              [31m^[39m
    [90m233| [39m          code[33m:[39m [32m"INTERNAL_SERVER_ERROR"[39m[33m,[39m
    [90m234| [39m          message[33m:[39m [32m"Failed to create defect. Please try again."[39m[33m,[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m227:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: Error[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, ?, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 510005,Test Defect - Critical,This is a test defect for critical transaction testing,reported,high,1,NCR[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m Module.createDefect server/db.ts:[2m1558:10[22m[39m
[90m [2mâ¯[22m server/routers/defectRouter.ts:[2m176:24[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m227:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, ?, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', params: [ 510005, 'Test Defect - Critical', 'This is a test defect for critical transaction testing', 'reported', 'high', 1, 'NCR' ] }[39m
[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 510005, default, \'Test Defect - Critical\', \'This is a test defect for critical transaction testing\', default, \'reported\', \'high\', default, 1, default, default, default, default, \'NCR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould set default status to reported
[31m[1mTRPCError[22m: Failed to create defect. Please try again.[39m
[36m [2mâ¯[22m server/routers/defectRouter.ts:[2m232:15[22m[39m
    [90m230| [39m
    [90m231| [39m        [90m// Wrap other errors[39m
    [90m232| [39m        [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m              [31m^[39m
    [90m233| [39m          code[33m:[39m [32m"INTERNAL_SERVER_ERROR"[39m[33m,[39m
    [90m234| [39m          message[33m:[39m [32m"Failed to create defect. Please try again."[39m[33m,[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m269:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: Error[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 510010,Test Default Status,reported,low,1,PAR[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m Module.createDefect server/db.ts:[2m1558:10[22m[39m
[90m [2mâ¯[22m server/routers/defectRouter.ts:[2m176:24[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m269:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', params: [ 510010, 'Test Default Status', 'reported', 'low', 1, 'PAR' ] }[39m
[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 510010, default, \'Test Default Status\', default, default, \'reported\', \'low\', default, 1, default, default, default, default, \'PAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould create task checklist with valid data
[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould validate task existence
[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould validate template existence
[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateTaskChecklist - Checklist Creation Transaction[2m > [22mshould prevent duplicate checklists for same task and stage
[31m[1mTRPCError[22m: status: Invalid task status: pending_pre_inspection[39m
[36m [2mâ¯[22m server/routers/taskRouter.ts:[2m125:17[22m[39m
    [90m123| [39m
    [90m124| [39m        [35mif[39m ([33m![39mvalidation[33m.[39mvalid) {
    [90m125| [39m          [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m                [31m^[39m
    [90m126| [39m            code[33m:[39m [32m"BAD_REQUEST"[39m[33m,[39m
    [90m127| [39m            message[33m:[39m validation[33m.[39merrors[33m?.[39m[34mjoin[39m([32m", "[39m) [33m||[39m [32m"Invalid input"[39m[33m,[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:23[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:24[22m[39m
[90m [2mâ¯[22m Object.next node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m262:12[22m[39m
[90m [2mâ¯[22m inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m50:15[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m322:20[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'BAD_REQUEST' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mDatabase Integrity Tests[2m > [22mshould maintain referential integrity on project deletion
[31m[1mTRPCError[22m: Failed to create defect. Please try again.[39m
[36m [2mâ¯[22m server/routers/defectRouter.ts:[2m232:15[22m[39m
    [90m230| [39m
    [90m231| [39m        [90m// Wrap other errors[39m
    [90m232| [39m        [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m              [31m^[39m
    [90m233| [39m          code[33m:[39m [32m"INTERNAL_SERVER_ERROR"[39m[33m,[39m
    [90m234| [39m          message[33m:[39m [32m"Failed to create defect. Please try again."[39m[33m,[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m438:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: Error[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 510017,Integrity Test Defect,reported,medium,1,CAR[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m Module.createDefect server/db.ts:[2m1558:10[22m[39m
[90m [2mâ¯[22m server/routers/defectRouter.ts:[2m176:24[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m438:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', params: [ 510017, 'Integrity Test Defect', 'reported', 'medium', 1, 'CAR' ] }[39m
[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 510017, default, \'Integrity Test Defect\', default, default, \'reported\', \'medium\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mDatabase Integrity Tests[2m > [22mshould handle concurrent updates correctly
[31m[1mTRPCError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
    [90m199| [39m[35mexport[39m [35mfunction[39m [34mgetClientIp[39m(req[33m:[39m any)[33m:[39m string [33m|[39m undefined {
    [90m200| [39m  [35mreturn[39m (
    [90m201| [39m    req[33m.[39mheaders[[32m'x-forwarded-for'[39m][33m?.[39m[34msplit[39m([32m','[39m)[[34m0[39m][33m?.[39m[34mtrim[39m() [33m||[39m
    [90m   | [39m        [31m^[39m
    [90m202| [39m    req[33m.[39mheaders[[32m'x-real-ip'[39m] [33m||[39m
    [90m203| [39m    req[33m.[39msocket[33m?.[39mremoteAddress [33m||[39m
[90m [2mâ¯[22m server/routers/projectRouter.ts:[2m127:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m481:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: TypeError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
[90m [2mâ¯[22m server/routers/projectRouter.ts:[2m127:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/critical-transactions.test.ts:[2m481:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mlist procedure[2m > [22mshould return paginated projects list
[31m[1mAssertionError[22m: expected 25 to be 10 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 25[39m

[36m [2mâ¯[22m server/__tests__/projects-simple.test.ts:[2m47:42[22m[39m
    [90m 45| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(result[33m.[39mitems))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 46| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mcurrentPage)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m 47| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mpageSize)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m 48| [39m    })[33m;[39m
    [90m 49| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mget procedure[2m > [22mshould return null for non-existent project
[31m[1mAssertionError[22m: expected undefined to be null[39m

[32m- Expected:[39m 
null

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/__tests__/projects-simple.test.ts:[2m72:22[22m[39m
    [90m 70| [39m      [35mconst[39m result [33m=[39m [35mawait[39m caller[33m.[39mproject[33m.[39m[35mget[39m({ id[33m:[39m [34m999999[39m })[33m;[39m
    [90m 71| [39m      
    [90m 72| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeNull[39m()[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m 73| [39m    })[33m;[39m
    [90m 74| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mupdate procedure[2m > [22mshould update an existing project
[31m[1mTRPCError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
    [90m199| [39m[35mexport[39m [35mfunction[39m [34mgetClientIp[39m(req[33m:[39m any)[33m:[39m string [33m|[39m undefined {
    [90m200| [39m  [35mreturn[39m (
    [90m201| [39m    req[33m.[39mheaders[[32m'x-forwarded-for'[39m][33m?.[39m[34msplit[39m([32m','[39m)[[34m0[39m][33m?.[39m[34mtrim[39m() [33m||[39m
    [90m   | [39m        [31m^[39m
    [90m202| [39m    req[33m.[39mheaders[[32m'x-real-ip'[39m] [33m||[39m
    [90m203| [39m    req[33m.[39msocket[33m?.[39mremoteAddress [33m||[39m
[90m [2mâ¯[22m server/routers/projectRouter.ts:[2m127:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/projects-simple.test.ts:[2m165:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: TypeError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
[90m [2mâ¯[22m server/routers/projectRouter.ts:[2m127:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/projects-simple.test.ts:[2m165:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mlistProjects[2m > [22mshould list all projects with pagination
[31m[1mAssertionError[22m: expected 25 to be 10 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 25[39m

[36m [2mâ¯[22m server/__tests__/projects.test.ts:[2m130:42[22m[39m
    [90m128| [39m      [34mexpect[39m(result[33m.[39mpagination)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m129| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mcurrentPage)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m130| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mpageSize)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m131| [39m    })[33m;[39m
    [90m132| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mupdateProject[2m > [22mshould update project successfully
[31m[1mTRPCError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
    [90m199| [39m[35mexport[39m [35mfunction[39m [34mgetClientIp[39m(req[33m:[39m any)[33m:[39m string [33m|[39m undefined {
    [90m200| [39m  [35mreturn[39m (
    [90m201| [39m    req[33m.[39mheaders[[32m'x-forwarded-for'[39m][33m?.[39m[34msplit[39m([32m','[39m)[[34m0[39m][33m?.[39m[34mtrim[39m() [33m||[39m
    [90m   | [39m        [31m^[39m
    [90m202| [39m    req[33m.[39mheaders[[32m'x-real-ip'[39m] [33m||[39m
    [90m203| [39m    req[33m.[39msocket[33m?.[39mremoteAddress [33m||[39m
[90m [2mâ¯[22m server/routers/projectRouter.ts:[2m127:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/projects.test.ts:[2m172:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'INTERNAL_SERVER_ERROR' }[39m
[31m[1mCaused by: TypeError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2mâ¯[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
[90m [2mâ¯[22m server/routers/projectRouter.ts:[2m127:9[22m[39m
[90m [2mâ¯[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2mâ¯[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2mâ¯[22m server/__tests__/projects.test.ts:[2m172:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mInput Validation[2m > [22mshould validate file upload size
[31m[1mAssertionError[22m: expected [ 400, 413 ] to include 403[39m
[36m [2mâ¯[22m tests/integration/security.test.ts:[2m114:26[22m[39m
    [90m112| [39m
    [90m113| [39m      [90m// Should reject oversized files[39m
    [90m114| [39m      [34mexpect[39m([[34m400[39m[33m,[39m [34m413[39m])[33m.[39m[34mtoContain[39m(response[33m.[39mstatus)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m115| [39m    })[33m;[39m
    [90m116| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould complete checklist items in correct order
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892275598,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/checklist-completion-flow.test.ts:[2m61:21[22m[39m
    [90m 59| [39m
    [90m 60| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 61| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 62| [39m      code[33m:[39m [32m`TEST-CL-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 63| [39m      name[33m:[39m [32m"Test Project for Checklist"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Checklist', 'TEST-CL-1763892275598', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Checklist\', \'TEST-CL-1763892275598\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould enforce dependency constraints
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892276323,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/checklist-completion-flow.test.ts:[2m61:21[22m[39m
    [90m 59| [39m
    [90m 60| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 61| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 62| [39m      code[33m:[39m [32m`TEST-CL-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 63| [39m      name[33m:[39m [32m"Test Project for Checklist"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Checklist', 'TEST-CL-1763892276323', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Checklist\', \'TEST-CL-1763892276323\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould handle failed checklist items
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892277045,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/checklist-completion-flow.test.ts:[2m61:21[22m[39m
    [90m 59| [39m
    [90m 60| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 61| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 62| [39m      code[33m:[39m [32m`TEST-CL-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 63| [39m      name[33m:[39m [32m"Test Project for Checklist"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Checklist', 'TEST-CL-1763892277045', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Checklist\', \'TEST-CL-1763892277045\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/checklist-completion-flow.test.ts[2m > [22mMulti-step Checklist Completion Integration Tests[2m > [22mshould allow re-completion of failed items
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Checklist,TEST-CL-1763892277768,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/checklist-completion-flow.test.ts:[2m61:21[22m[39m
    [90m 59| [39m
    [90m 60| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 61| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 62| [39m      code[33m:[39m [32m`TEST-CL-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 63| [39m      name[33m:[39m [32m"Test Project for Checklist"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Checklist', 'TEST-CL-1763892277768', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Checklist\', \'TEST-CL-1763892277768\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould auto-escalate overdue defect
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892276248,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/defect-escalation-flow.test.ts:[2m59:21[22m[39m
    [90m 57| [39m
    [90m 58| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 59| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 60| [39m      code[33m:[39m [32m`TEST-ESC-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 61| [39m      name[33m:[39m [32m"Test Project for Escalation"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Escalation', 'TEST-ESC-1763892276248', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Escalation\', \'TEST-ESC-1763892276248\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould handle manual escalation by PM
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892277195,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/defect-escalation-flow.test.ts:[2m59:21[22m[39m
    [90m 57| [39m
    [90m 58| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 59| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 60| [39m      code[33m:[39m [32m`TEST-ESC-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 61| [39m      name[33m:[39m [32m"Test Project for Escalation"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Escalation', 'TEST-ESC-1763892277195', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Escalation\', \'TEST-ESC-1763892277195\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould escalate through multiple levels
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892278137,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/defect-escalation-flow.test.ts:[2m59:21[22m[39m
    [90m 57| [39m
    [90m 58| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 59| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 60| [39m      code[33m:[39m [32m`TEST-ESC-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 61| [39m      name[33m:[39m [32m"Test Project for Escalation"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Escalation', 'TEST-ESC-1763892278137', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Escalation\', \'TEST-ESC-1763892278137\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/46]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/integration/defect-escalation-flow.test.ts[2m > [22mDefect Escalation Process Integration Tests[2m > [22mshould prevent escalation beyond critical
[31m[1mError[22m: Failed query: insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)
params: Test Project for Escalation,TEST-ESC-1763892279077,in_progress,NaN[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2mâ¯[22m server/__tests__/integration/defect-escalation-flow.test.ts:[2m59:21[22m[39m
    [90m 57| [39m
    [90m 58| [39m    [90m// à¸ªà¸£à¹‰à¸²à¸‡ test project[39m
    [90m 59| [39m    [35mconst[39m project [33m=[39m [35mawait[39m testDb[33m.[39m[34minsert[39m(projects)[33m.[39m[34mvalues[39m({
    [90m   | [39m                    [31m^[39m
    [90m 60| [39m      code[33m:[39m [32m`TEST-ESC-[39m[36m${[39m[33mDate[39m[33m.[39m[34mnow[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m 61| [39m      name[33m:[39m [32m"Test Project for Escalation"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ query: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, ?, ?, default, default, default, default, default, default, default, ?, default, default, ?, default, default, default, default, default)', params: [ 'Test Project for Escalation', 'TEST-ESC-1763892279077', 'in_progress', NaN ] }[39m
[31m[1mCaused by: Error[22m: Unknown column 'nan' in 'field list'[39m
[90m [2mâ¯[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2mâ¯[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_BAD_FIELD_ERROR', errno: 1054, sql: 'insert into `projects` (`id`, `name`, `code`, `location`, `latitude`, `longitude`, `ownerName`, `startDate`, `endDate`, `budget`, `status`, `completionPercentage`, `color`, `createdBy`, `createdAt`, `updatedAt`, `archivedAt`, `archivedBy`, `archivedReason`) values (default, \'Test Project for Escalation\', \'TEST-ESC-1763892279077\', default, default, default, default, default, default, default, \'in_progress\', default, default, NaN, default, default, default, default, default)', sqlState: '42S22', sqlMessage: 'Unknown column \'nan\' in \'field list\'' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/46]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m13 failed[39m[22m[2m | [22m[1m[32m18 passed[39m[22m[90m (31)[39m
[2m      Tests [22m [1m[31m38 failed[39m[22m[2m | [22m[1m[32m252 passed[39m[22m[2m | [22m[33m10 skipped[39m[90m (300)[39m
[2m   Start at [22m 05:04:32
[2m   Duration [22m 40.38s[2m (transform 2.78s, setup 0ms, collect 20.04s, tests 152.06s, environment 5ms, prepare 216ms)[22m

â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
