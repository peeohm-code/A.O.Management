
> construction_management_app@1.0.0 test /home/ubuntu/construction_management_app
> vitest run


[1m[46m RUN [49m[22m [36mv4.0.9 [39m[90m/home/ubuntu/construction_management_app[39m

Sourcemap for "/home/ubuntu/construction_management_app/node_modules/.pnpm/node-cron@4.2.1/node_modules/node-cron/dist/esm/node-cron.js" points to missing source files
[90mstdout[2m | tests/checklist-item-update.test.ts[2m > [22m[2mChecklist Item Update
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateProject - Project Creation Transaction[2m > [22m[2mshould create project with valid data
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/routers.test.ts[2m > [22m[2mTask Procedures Integration Tests
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/projects-simple.test.ts[2m > [22m[2mProjects Router - Simple Tests[2m > [22m[2mlist procedure[2m > [22m[2mshould return paginated projects list
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/projects.test.ts[2m > [22m[2mProjects Router[2m > [22m[2mcreateProject[2m > [22m[2mshould create a new project successfully
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/projects.test.ts[2m > [22m[2mProjects Router[2m > [22m[2mupdateProject[2m > [22m[2mshould update project successfully
[22m[39m2025-11-23T10:58:55.044Z INFO  [AuditTrail] update on project:600005 by user:1

[90mstderr[2m | server/__tests__/projects.test.ts[2m > [22m[2mProjects Router[2m > [22m[2mupdateProject[2m > [22m[2mshould update project successfully
[22m[39m[Socket.io] Failed to emit notification: Error: Socket.io not initialized. Call initializeSocket first.
    at getIO [90m(/home/ubuntu/construction_management_app/[39mserver/_core/socket.ts:31:11[90m)[39m
    at emitNotification [90m(/home/ubuntu/construction_management_app/[39mserver/_core/socket.ts:50:22[90m)[39m
    at [90m/home/ubuntu/construction_management_app/[39mserver/routers/projectRouter.ts:172:13
    at Array.forEach (<anonymous>)
    at [90m/home/ubuntu/construction_management_app/[39mserver/routers/projectRouter.ts:171:19
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at resolveMiddleware [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:221:17[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at procedure [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:281:18[90m)[39m
    at [90mfile:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/tracked-Blz8XOf1.mjs:298:13
    at [90m/home/ubuntu/construction_management_app/[39mserver/__tests__/projects.test.ts:172:22
    at [90mfile:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.9/node_modules/[4m@vitest[24m/runner/dist/index.js:753:20

[90mstdout[2m | server/__tests__/projects-simple.test.ts[2m > [22m[2mProjects Router - Simple Tests[2m > [22m[2mupdate procedure[2m > [22m[2mshould update an existing project
[22m[39m2025-11-23T10:58:56.151Z INFO  [AuditTrail] update on project:600009 by user:1

 [31m‚ùØ[39m server/__tests__/projects.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 7454[2mms[22m[39m
[31m       [31m√ó[31m should create a new project successfully[39m[33m 2455[2mms[22m[39m
       [32m‚úì[39m should fail to create project without required fields[32m 3[2mms[22m[39m
       [33m[2m‚úì[22m[39m should retrieve project by ID [33m 1488[2mms[22m[39m
       [32m‚úì[39m should return null for non-existent project[32m 216[2mms[22m[39m
[31m       [31m√ó[31m should list all projects with pagination[39m[33m 666[2mms[22m[39m
       [33m[2m‚úì[22m[39m should filter projects by status [33m 656[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update project successfully [33m 1316[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return project statistics [33m 434[2mms[22m[39m
[90mstderr[2m | server/__tests__/projects-simple.test.ts[2m > [22m[2mProjects Router - Simple Tests[2m > [22m[2mupdate procedure[2m > [22m[2mshould update an existing project
[22m[39m[Socket.io] Failed to emit notification: Error: Socket.io not initialized. Call initializeSocket first.
    at getIO [90m(/home/ubuntu/construction_management_app/[39mserver/_core/socket.ts:31:11[90m)[39m
    at emitNotification [90m(/home/ubuntu/construction_management_app/[39mserver/_core/socket.ts:50:22[90m)[39m
    at [90m/home/ubuntu/construction_management_app/[39mserver/routers/projectRouter.ts:172:13
    at Array.forEach (<anonymous>)
    at [90m/home/ubuntu/construction_management_app/[39mserver/routers/projectRouter.ts:171:19
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at resolveMiddleware [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:221:17[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at callRecursive [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:256:18[90m)[39m
    at procedure [90m(file:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/initTRPC-CB9uBez5.mjs:281:18[90m)[39m
    at [90mfile:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@trpc+server@11.6.0_typescript@5.9.3/node_modules/[4m@trpc[24m/server/dist/tracked-Blz8XOf1.mjs:298:13
    at [90m/home/ubuntu/construction_management_app/[39mserver/__tests__/projects-simple.test.ts:165:22
    at [90mfile:///home/ubuntu/construction_management_app/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.9/node_modules/[4m@vitest[24m/runner/dist/index.js:753:20

 [31m‚ùØ[39m server/__tests__/projects-simple.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 7711[2mms[22m[39m
[31m       [31m√ó[31m should return paginated projects list[39m[33m 1880[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle pagination correctly [33m 677[2mms[22m[39m
[31m       [31m√ó[31m should return null for non-existent project[39m[32m 224[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return project if exists [33m 896[2mms[22m[39m
       [32m‚úì[39m should return a valid project code[32m 223[2mms[22m[39m
[31m       [31m√ó[31m should create a new project[39m[33m 1338[2mms[22m[39m
       [32m‚úì[39m should fail with invalid data[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should update an existing project[39m[33m 2467[2mms[22m[39m
[90mstdout[2m | server/db.test.ts[2m > [22m[2mTask Management[2m > [22m[2mcreateTask[2m > [22m[2mshould create a task with valid data
[22m[39m[Database] Connection pool created with limit: 10

 [31m‚ùØ[39m tests/checklist-item-update.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 8261[2mms[22m[39m
[31m     [31m√ó[31m should update checklist item result[39m[32m 4[2mms[22m[39m
[31m     [31m√ó[31m should update only result without comments[39m[32m 1[2mms[22m[39m
     [32m‚úì[39m should throw error for non-existent item[32m 2[2mms[22m[39m
[90mstdout[2m | server/__tests__/project-delete.test.ts[2m > [22m[2mProject Delete
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/inspection-stats.test.ts[2m > [22m[2mInspection Statistics API[2m > [22m[2mshould get pass/fail rate statistics
[22m[39m[Database] Connection pool created with limit: 10

 [31m‚ùØ[39m server/db.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 2392[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create a task with valid data [33m 1477[2mms[22m[39m
       [32m‚úì[39m should convert string dates to Date objects[32m 225[2mms[22m[39m
       [32m‚úì[39m should handle missing optional fields[32m 225[2mms[22m[39m
[31m       [31m√ó[31m should create a defect with valid data[39m[32m 238[2mms[22m[39m
[31m       [31m√ó[31m should set default status to 'reported'[39m[32m 221[2mms[22m[39m
[31m       [31m√ó[31m should submit inspection with all passed items[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should create defects for failed items[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should set overall status to 'failed' when any item fails[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should set overall status to 'completed' when all items pass[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update task status[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle all valid status values[39m[32m 0[2mms[22m[39m
 [31m‚ùØ[39m server/__tests__/project-delete.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 2324[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should allow admin to delete project
     [2m[90m‚Üì[39m[22m should prevent non-admin from deleting project
     [2m[90m‚Üì[39m[22m should return error when deleting non-existent project
 [31m‚ùØ[39m tests/integration/security.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 414[2mms[22m[39m
       [32m‚úì[39m should reject requests without CSRF token[32m 54[2mms[22m[39m
       [32m‚úì[39m should accept requests with valid CSRF token[32m 4[2mms[22m[39m
       [32m‚úì[39m should enforce rate limits on API endpoints[32m 267[2mms[22m[39m
       [32m‚úì[39m should have stricter limits on upload endpoints[32m 13[2mms[22m[39m
       [32m‚úì[39m should validate file upload types[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should validate file upload size[39m[32m 66[2mms[22m[39m
       [32m‚úì[39m should have virus scanning available[32m 2[2mms[22m[39m
       [32m‚úì[39m should protect API endpoints from unauthorized access[32m 2[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould create defect with valid data
[22m[39m2025-11-23T10:59:00.099Z ERROR [[object Object]] Failed to create defect

[90mstderr[2m | server/inspection-stats.test.ts[2m > [22m[2mError Tracking API[2m > [22m[2mshould log an error
[22m[39mError logged: {
  message: [32m'Test error message'[39m,
  stack: [32m'Error: Test error\\n    at test.ts:1:1'[39m,
  severity: [32m'error'[39m,
  category: [32m'backend'[39m,
  userId: [33m1[39m
}

 [31m‚ùØ[39m server/inspection-stats.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 2047[2mms[22m[39m
     [33m[2m‚úì[22m[39m should get pass/fail rate statistics [33m 1367[2mms[22m[39m
     [32m‚úì[39m should get defect trends[32m 231[2mms[22m[39m
     [32m‚úì[39m should get inspector performance metrics[32m 219[2mms[22m[39m
     [32m‚úì[39m should get checklist item statistics[32m 220[2mms[22m[39m
     [32m‚úì[39m should log an error[32m 2[2mms[22m[39m
     [32m‚úì[39m should get error logs with filtering[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should get error statistics[39m[32m 5[2mms[22m[39m
     [32m‚úì[39m should update error status[32m 0[2mms[22m[39m
[90mstdout[2m | server/__tests__/checklist-pending-count.test.ts[2m > [22m[2mChecklist Pending Count
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/inspection-notification.test.ts[2m > [22m[2mInspection Notification System
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/escalation.test.ts[2m > [22m[2mEscalation System
[22m[39m[Database] Connection pool created with limit: 10

[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould set default status to reported
[22m[39m2025-11-23T10:59:06.903Z ERROR [[object Object]] Failed to create defect

 [31m‚ùØ[39m server/routers.test.ts [2m([22m[2m24 tests[22m[2m | [22m[31m2 failed[39m[2m | [22m[33m7 skipped[39m[2m)[22m[33m 18618[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create task with valid input [33m 450[2mms[22m[39m
       [32m‚úì[39m should reject task creation with invalid status[32m 3[2mms[22m[39m
       [32m‚úì[39m should reject task creation with invalid priority[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject task creation with invalid progress[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject task creation with empty name[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject task creation with invalid project ID[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update task with valid data[39m[33m 447[2mms[22m[39m
       [32m‚úì[39m should reject update with invalid status[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject update with invalid progress[32m 1[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should submit inspection with valid item results
       [2m[90m‚Üì[39m[22m should reject inspection with invalid result value
       [2m[90m‚Üì[39m[22m should reject inspection with empty item results
       [2m[90m‚Üì[39m[22m should reject inspection with invalid template item ID
[31m       [31m√ó[31m should create defect with valid input[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should reject defect creation with empty title[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject defect creation with invalid severity[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject defect creation with invalid task ID[32m 0[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should update defect with valid data
       [2m[90m‚Üì[39m[22m should reject update with invalid status
       [2m[90m‚Üì[39m[22m should reject update with invalid severity
     [32m‚úì[39m should enforce type safety for task status[32m 1[2mms[22m[39m
     [32m‚úì[39m should enforce type safety for task priority[32m 0[2mms[22m[39m
     [32m‚úì[39m should enforce type safety for defect severity[32m 0[2mms[22m[39m
     [32m‚úì[39m should enforce type safety for checklist result[32m 0[2mms[22m[39m
[90mstdout[2m | server/__tests__/checklistItemUpdate.test.ts[2m > [22m[2mChecklist Item Update Tests - Comments Field
[22m[39m[Database] Connection pool created with limit: 10

[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould validate project and task existence
[22m[39m2025-11-23T10:59:10.399Z ERROR [[object Object]] Failed to create defect

 [32m‚úì[39m server/__tests__/inspection-notification.test.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 9441[2mms[22m[39m
     [33m[2m‚úì[22m[39m should update notificationSent flag when inspection fails [33m 436[2mms[22m[39m
     [33m[2m‚úì[22m[39m should send notification to task assignee when inspection fails [33m 652[2mms[22m[39m
     [33m[2m‚úì[22m[39m should send notification to project manager when inspection fails [33m 432[2mms[22m[39m
[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mcreateDefect - Defect Creation Transaction[2m > [22m[2mshould validate project and task existence
[22m[39m2025-11-23T10:59:10.615Z ERROR [[object Object]] Failed to create defect

[90mstdout[2m | server/__tests__/escalation.test.ts[2m > [22m[2mEscalation System[2m > [22m[2mManual Escalation Trigger[2m > [22m[2mshould manually trigger escalation check
[22m[39m2025-11-23T10:59:11.531Z INFO  [Escalation] No active escalation rules found

[90mstdout[2m | server/__tests__/inspection.test.ts[2m > [22m[2mInspection Router
[22m[39m[Database] Connection pool created with limit: 10

 [32m‚úì[39m server/__tests__/escalation.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 10073[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create escalation rule [33m 1577[2mms[22m[39m
       [33m[2m‚úì[22m[39m should list all escalation rules [33m 1777[2mms[22m[39m
       [33m[2m‚úì[22m[39m should get escalation rule by ID [33m 1776[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update escalation rule [33m 2220[2mms[22m[39m
       [33m[2m‚úì[22m[39m should manually trigger escalation check [33m 445[2mms[22m[39m
[90mstdout[2m | server/services/analytics.service.test.ts[2m > [22m[2mAnalytics Service - SQL Aggregations
[22m[39m[Database] Connection pool created with limit: 10

[90mstderr[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mDatabase Integrity Tests[2m > [22m[2mshould maintain referential integrity on project deletion
[22m[39m2025-11-23T10:59:14.325Z ERROR [[object Object]] Failed to create defect

 [32m‚úì[39m server/__tests__/checklist-pending-count.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 13560[2mms[22m[39m
     [33m[2m‚úì[22m[39m should count pending and in_progress checklists correctly [33m 4207[2mms[22m[39m
     [33m[2m‚úì[22m[39m should return 0 when no pending checklists exist [33m 1552[2mms[22m[39m
[90mstdout[2m | server/__tests__/rbac.test.ts[2m > [22m[2mRBAC Authorization Tests[2m > [22m[2mAuthorization Functions Return Boolean[2m > [22m[2mcanEditProject should return boolean for invalid inputs
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/checklistItemUpdate.test.ts[2m > [22m[2mChecklist Item Update Tests - Comments Field
[22m[39m[Database] Connection pool closed

 [32m‚úì[39m server/__tests__/checklistItemUpdate.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 7973[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update result and comments successfully [33m 442[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update comments with Thai text [33m 436[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update comments with long text [33m 436[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update comments to empty string [33m 655[2mms[22m[39m
       [33m[2m‚úì[22m[39m should preserve comments when updating only result [33m 655[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update photoUrls and comments together [33m 436[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle special characters in comments [33m 435[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle newlines and tabs in comments [33m 434[2mms[22m[39m
       [33m[2m‚úì[22m[39m should retrieve item with all fields including comments [33m 436[2mms[22m[39m
[90mstdout[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mDatabase Integrity Tests[2m > [22m[2mshould handle concurrent updates correctly
[22m[39m2025-11-23T10:59:16.284Z INFO  [AuditTrail] update on project:600023 by user:1

 [32m‚úì[39m server/middleware/__tests__/permissions.test.ts [2m([22m[2m47 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstderr[2m | server/__tests__/rbac.test.ts[2m > [22m[2mRBAC Authorization Tests[2m > [22m[2mAuthorization Functions Return Boolean[2m > [22m[2mcanEditTask should return boolean for invalid inputs
[22m[39m2025-11-23T10:59:16.572Z ERROR [[object Object]] [RBAC] canEditTask failed
{}

[90mstderr[2m | server/__tests__/rbac.test.ts[2m > [22m[2mRBAC Authorization Tests[2m > [22m[2mAuthorization Functions Return Boolean[2m > [22m[2mcanDeleteTask should return boolean for invalid inputs
[22m[39m2025-11-23T10:59:16.573Z ERROR [[object Object]] [RBAC] canDeleteTask failed
{}

 [32m‚úì[39m server/services/__tests__/defect.service.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32m‚úì[39m server/services/__tests__/task.service.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32m‚úì[39m server/__tests__/rbac.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 2406[2mms[22m[39m
       [33m[2m‚úì[22m[39m canEditProject should return boolean for invalid inputs [33m 1466[2mms[22m[39m
 [32m‚úì[39m server/__tests__/checklistOperations.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32m‚úì[39m server/__tests__/taskFiltering.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mDatabase Integrity Tests[2m > [22m[2mshould handle concurrent updates correctly
[22m[39m2025-11-23T10:59:17.446Z INFO  [AuditTrail] update on project:600023 by user:1

[90mstdout[2m | server/__tests__/critical-transactions.test.ts[2m > [22m[2mCritical Transaction Tests[2m > [22m[2mDatabase Integrity Tests[2m > [22m[2mshould handle concurrent updates correctly
[22m[39m2025-11-23T10:59:17.508Z INFO  [AuditTrail] update on project:600023 by user:1

 [32m‚úì[39m server/utils/__tests__/bigint.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32m‚úì[39m server/__tests__/logger.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection[2m > [22m[2mshould establish database connection
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection[2m > [22m[2mshould close connection gracefully
[22m[39m[Database] Connection pool closed

[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection[2m > [22m[2mshould close connection gracefully
[22m[39m[Database] Connection pool created with limit: 10

[90mstdout[2m | server/__tests__/db.test.ts[2m > [22m[2mDatabase Connection
[22m[39m[Database] Connection pool closed

 [32m‚úì[39m server/__tests__/db.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32m‚úì[39m server/__tests__/routers.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32m‚úì[39m server/__tests__/taskStatusCalculation.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | server/services/analytics.service.test.ts[2m > [22m[2mPerformance Comparison[2m > [22m[2mshould demonstrate SQL aggregations are faster than JavaScript loops
[22m[39mOptimized (SQL aggregations): 458ms

 [32m‚úì[39m server/services/analytics.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 6057[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return dashboard statistics using SQL aggregations [33m 2361[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return project statistics using SQL aggregations [33m 691[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return stats for multiple projects using SQL aggregations [33m 690[2mms[22m[39m
       [33m[2m‚úì[22m[39m should filter by project ID when provided [33m 460[2mms[22m[39m
     [33m[2m‚úì[22m[39m should demonstrate SQL aggregations are faster than JavaScript loops [33m 688[2mms[22m[39m
 [2m[90m‚Üì[39m[22m server/__tests__/integration/checklist-completion-flow.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m
 [31m‚ùØ[39m server/__tests__/critical-transactions.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m4 failed[39m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 29802[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create project with valid data [33m 3583[2mms[22m[39m
       [32m‚úì[39m should validate required fields[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should prevent duplicate project codes[39m[33m 3269[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set default values correctly [33m 1955[2mms[22m[39m
[31m       [31m√ó[31m should create defect with valid data[39m[33m 3743[2mms[22m[39m
       [33m[2m‚úì[22m[39m should validate required fields for defect [33m 3066[2mms[22m[39m
[31m       [31m√ó[31m should set default status to reported[39m[33m 3721[2mms[22m[39m
       [33m[2m‚úì[22m[39m should validate project and task existence [33m 3706[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create task checklist with valid data
       [2m[90m‚Üì[39m[22m should validate task existence
       [2m[90m‚Üì[39m[22m should validate template existence
       [2m[90m‚Üì[39m[22m should prevent duplicate checklists for same task and stage
[31m       [31m√ó[31m should maintain referential integrity on project deletion[39m[33m 2391[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle concurrent updates correctly [33m 4364[2mms[22m[39m
 [2m[90m‚Üì[39m[22m server/__tests__/integration/defect-escalation-flow.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m
[90mstdout[2m | server/test-template-create.test.ts[2m > [22m[2mTemplates Router[2m > [22m[2mshould have templates.create mutation
[22m[39mtemplates.create mutation exists

 [32m‚úì[39m server/test-template-create.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32m‚úì[39m server/__tests__/inspection.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 8888[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle pagination correctly [33m 474[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return inspections for a specific project [33m 460[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 6 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mInspection Procedures Integration Tests
[31m[1mTypeError[22m: __vite_ssr_import_2__.createChecklistTemplateItem is not a function[39m
[36m [2m‚ùØ[22m server/routers.test.ts:[2m249:14[22m[39m
    [90m247| [39m
    [90m248| [39m    [90m// Add template items[39m
    [90m249| [39m    [35mawait[39m db[33m.[39m[34mcreateChecklistTemplateItem[39m({
    [90m   | [39m             [31m^[39m
    [90m250| [39m      templateId[33m:[39m testTemplateId[33m,[39m
    [90m251| [39m      itemNumber[33m:[39m [34m1[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.update
[31m[1mError[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 570010,Defect for Update Tests,reported,medium,1,CAR[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2m‚ùØ[22m Module.createDefect server/db.ts:[2m1567:10[22m[39m
    [90m1565| [39m  if (!db) throw new Error("Database not available");
    [90m1566| [39m
    [90m1567| [39m  return await db.insert(defects).values({
    [90m   | [39m         [31m^[39m
    [90m1568| [39m    projectId: data.projectId,
    [90m1569| [39m    taskId: data.taskId,
[90m [2m‚ùØ[22m server/routers.test.ts:[2m444:22[22m[39m

[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2m‚ùØ[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2m‚ùØ[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2m‚ùØ[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 570010, default, \'Defect for Update Tests\', default, default, \'reported\', \'medium\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/project-delete.test.ts[2m > [22mProject Delete
[31m[1mError[22m: Failed query: insert into `projectMembers` (`id`, `projectId`, `userId`, `role`, `createdAt`) values (default, ?, ?, ?, default)
params: 600013,9999,project_manager[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2m‚ùØ[22m server/db.ts:[2m335:5[22m[39m
    [90m333| [39m
    [90m334| [39m    // Insert project member (creator as project manager)
    [90m335| [39m    await tx.insert(projectMembers).values({
    [90m   | [39m    [31m^[39m
    [90m336| [39m      projectId,
    [90m337| [39m      userId: data.createdBy,
[90m [2m‚ùØ[22m MySql2Session.transaction node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m207:22[22m[39m
[90m [2m‚ùØ[22m Module.createProject server/db.ts:[2m303:10[22m[39m
[90m [2m‚ùØ[22m server/__tests__/project-delete.test.ts:[2m47:21[22m[39m

[31m[1mCaused by: Error[22m: Cannot add or update a child row: a foreign key constraint fails (`xgufrkfw3wtjbzrcqsfjbu`.`projectmembers`, CONSTRAINT `fk_projectMembers_userId` FOREIGN KEY (`userId`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)[39m
[90m [2m‚ùØ[22m PromisePoolConnection.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/connection.js:[2m29:22[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2m‚ùØ[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2m‚ùØ[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_REFERENCED_ROW_2', errno: 1452, sql: 'insert into `projectMembers` (`id`, `projectId`, `userId`, `role`, `createdAt`) values (default, 600013, 9999, \'project_manager\', default)', sqlState: '23000', sqlMessage: 'Cannot add or update a child row: a foreign key constraint fails (`xgufrkfw3wtjbzrcqsfjbu`.`projectmembers`, CONSTRAINT `fk_projectMembers_userId` FOREIGN KEY (`userId`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects.test.ts[2m > [22mProjects Router
[31m[1mError[22m: Failed query: delete from `projects` where ?
params: (t) => t.id.eq(testProjectId)[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2m‚ùØ[22m server/__tests__/projects.test.ts:[2m48:9[22m[39m
    [90m 46| [39m      [35mif[39m (db) {
    [90m 47| [39m        [35mconst[39m { projects } [33m=[39m [35mawait[39m [35mimport[39m([32m'../../drizzle/schema'[39m)[33m;[39m
    [90m 48| [39m        await db.delete(projects).where((t: any) => t.id.eq(testProjec‚Ä¶
    [90m   | [39m        [31m^[39m
    [90m 49| [39m      }
    [90m 50| [39m    }

[31m[1mCaused by: Error[22m: Truncated incorrect DOUBLE value: '?'[39m
[90m [2m‚ùØ[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2m‚ùØ[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/delete.js:[2m91:27[22m[39m
[90m [2m‚ùØ[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_TRUNCATED_WRONG_VALUE', errno: 1292, sql: 'delete from `projects` where \'(t) => t.id.eq(testProjectId)\'', sqlState: '22007', sqlMessage: 'Truncated incorrect DOUBLE value: \'?\'' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/e2e/auth.spec.ts[2m [ tests/e2e/auth.spec.ts ][22m
[31m[1mError[22m: Playwright Test did not expect test.describe() to be called here.
Most common reasons include:
- You are calling test.describe() in a configuration file.
- You are calling test.describe() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.[39m
[90m [2m‚ùØ[22m TestTypeImpl._currentSuite node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m74:13[22m[39m
[90m [2m‚ùØ[22m TestTypeImpl._describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m114:24[22m[39m
[90m [2m‚ùØ[22m Function.describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/transform/transform.js:[2m275:12[22m[39m
[36m [2m‚ùØ[22m tests/e2e/auth.spec.ts:[2m13:6[22m[39m
    [90m 11| [39m */[39m
    [90m 12| [39m
    [90m 13| [39mtest[33m.[39m[34mdescribe[39m([32m'Authentication Flow'[39m[33m,[39m () [33m=>[39m {
    [90m   | [39m     [31m^[39m
    [90m 14| [39m  test('should redirect to login when accessing protected page', async‚Ä¶
    [90m 15| [39m    [90m// Navigate to dashboard (protected page)[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/e2e/inspection.spec.ts[2m [ tests/e2e/inspection.spec.ts ][22m
[31m[1mError[22m: Playwright Test did not expect test.describe() to be called here.
Most common reasons include:
- You are calling test.describe() in a configuration file.
- You are calling test.describe() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.[39m
[90m [2m‚ùØ[22m TestTypeImpl._currentSuite node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m74:13[22m[39m
[90m [2m‚ùØ[22m TestTypeImpl._describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/common/testType.js:[2m114:24[22m[39m
[90m [2m‚ùØ[22m Function.describe node_modules/.pnpm/playwright@1.56.1/node_modules/playwright/lib/transform/transform.js:[2m275:12[22m[39m
[36m [2m‚ùØ[22m tests/e2e/inspection.spec.ts:[2m13:6[22m[39m
    [90m 11| [39m */[39m
    [90m 12| [39m
    [90m 13| [39mtest[33m.[39m[34mdescribe[39m([32m'QC Inspection Workflow'[39m[33m,[39m () [33m=>[39m {
    [90m   | [39m     [31m^[39m
    [90m 14| [39m  test[33m.[39m[34mbeforeEach[39m([35masync[39m ({ page }) [33m=>[39m {
    [90m 15| [39m    [90m// Note: These tests require authentication[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/30]‚éØ[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 24 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mDefect Management[2m > [22mcreateDefect[2m > [22mshould create a defect with valid data
[31m[1mError[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, ?, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 1,Test Defect,Test Description,reported,high,1,CAR[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2m‚ùØ[22m Proxy.createDefect server/db.ts:[2m1567:10[22m[39m
    [90m1565| [39m  if (!db) throw new Error("Database not available");
    [90m1566| [39m
    [90m1567| [39m  return await db.insert(defects).values({
    [90m   | [39m         [31m^[39m
    [90m1568| [39m    projectId: data.projectId,
    [90m1569| [39m    taskId: data.taskId,
[90m [2m‚ùØ[22m server/db.test.ts:[2m91:22[22m[39m

[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2m‚ùØ[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2m‚ùØ[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2m‚ùØ[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 1, default, \'Test Defect\', \'Test Description\', default, \'reported\', \'high\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mDefect Management[2m > [22mcreateDefect[2m > [22mshould set default status to 'reported'
[31m[1mError[22m: Failed query: insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, ?, default, ?, default, default, ?, ?, default, ?, default, default, default, default, ?, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)
params: 1,Test Defect,reported,medium,1,CAR[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m25:15[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:19[22m[39m
[36m [2m‚ùØ[22m Proxy.createDefect server/db.ts:[2m1567:10[22m[39m
    [90m1565| [39m  if (!db) throw new Error("Database not available");
    [90m1566| [39m
    [90m1567| [39m  return await db.insert(defects).values({
    [90m   | [39m         [31m^[39m
    [90m1568| [39m    projectId: data.projectId,
    [90m1569| [39m    taskId: data.taskId,
[90m [2m‚ùØ[22m server/db.test.ts:[2m103:22[22m[39m

[31m[1mCaused by: Error[22m: Field 'projectId' doesn't have a default value[39m
[90m [2m‚ùØ[22m PromisePool.query node_modules/.pnpm/mysql2@3.15.1/node_modules/mysql2/lib/promise/pool.js:[2m36:22[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m53:29[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/session.js:[2m23:22[22m[39m
[90m [2m‚ùØ[22m MySql2PreparedQuery.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql2/session.js:[2m52:30[22m[39m
[90m [2m‚ùØ[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/mysql-core/query-builders/insert.js:[2m121:27[22m[39m
[90m [2m‚ùØ[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.44.7_mysql2@3.15.1/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ER_NO_DEFAULT_FOR_FIELD', errno: 1364, sql: 'insert into `defects` (`id`, `projectId`, `taskId`, `checklistItemResultId`, `title`, `description`, `photoUrls`, `status`, `severity`, `assignedTo`, `reportedBy`, `resolvedBy`, `resolvedAt`, `resolutionPhotoUrls`, `resolutionComment`, `type`, `checklistId`, `rootCause`, `correctiveAction`, `preventiveAction`, `dueDate`, `actionMethod`, `actionResponsible`, `actionDeadline`, `actionNotes`, `ncrLevel`, `verifiedBy`, `verifiedAt`, `verificationComment`, `resolutionNotes`, `implementationMethod`, `beforePhotos`, `afterPhotos`, `closureNotes`, `createdAt`, `updatedAt`, `escalation`) values (default, default, 1, default, \'Test Defect\', default, default, \'reported\', \'medium\', default, 1, default, default, default, default, \'CAR\', default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default, default)', sqlState: 'HY000', sqlMessage: 'Field \'projectId\' doesn\'t have a default value' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould submit inspection with all passed items
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2m‚ùØ[22m server/db.test.ts:[2m124:28[22m[39m
    [90m122| [39m      }[33m;[39m
    [90m123| [39m
    [90m124| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m125| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m126| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould create defects for failed items
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2m‚ùØ[22m server/db.test.ts:[2m141:28[22m[39m
    [90m139| [39m      }[33m;[39m
    [90m140| [39m
    [90m141| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m142| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m143| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould set overall status to 'failed' when any item fails
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2m‚ùØ[22m server/db.test.ts:[2m157:28[22m[39m
    [90m155| [39m      }[33m;[39m
    [90m156| [39m
    [90m157| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m158| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m159| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mQC Inspection[2m > [22msubmitInspectionResults[2m > [22mshould set overall status to 'completed' when all items pass
[31m[1mError[22m: [vitest] No "submitInspectionResults" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2m‚ùØ[22m server/db.test.ts:[2m174:28[22m[39m
    [90m172| [39m      }[33m;[39m
    [90m173| [39m
    [90m174| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34msubmitInspectionResults[39m(inspectionData)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m175| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m176| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mTask Status Management[2m > [22mupdateTaskStatus[2m > [22mshould update task status
[31m[1mError[22m: [vitest] No "updateTaskStatus" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2m‚ùØ[22m server/db.test.ts:[2m183:28[22m[39m
    [90m181| [39m  [34mdescribe[39m([32m"updateTaskStatus"[39m[33m,[39m () [33m=>[39m {
    [90m182| [39m    [34mit[39m([32m"should update task status"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m183| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mupdateTaskStatus[39m([34m1[39m[33m,[39m [32m"in_progress"[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m184| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m185| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/db.test.ts[2m > [22mTask Status Management[2m > [22mupdateTaskStatus[2m > [22mshould handle all valid status values
[31m[1mError[22m: [vitest] No "updateTaskStatus" export is defined on the "./db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("./db"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[36m [2m‚ùØ[22m server/db.test.ts:[2m191:30[22m[39m
    [90m189| [39m      
    [90m190| [39m      [35mfor[39m ([35mconst[39m status [35mof[39m statuses) {
    [90m191| [39m        [35mconst[39m result [33m=[39m [35mawait[39m [34mupdateTaskStatus[39m([34m1[39m[33m,[39m status)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m192| [39m        [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m193| [39m      }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/inspection-stats.test.ts[2m > [22mError Tracking API[2m > [22mshould get error statistics
[31m[1mAssertionError[22m: expected { total: +0, bySeverity: {}, ‚Ä¶(1) } to have property "totalErrors"[39m
[36m [2m‚ùØ[22m server/inspection-stats.test.ts:[2m173:20[22m[39m
    [90m171| [39m    
    [90m172| [39m    [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m173| [39m    [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"totalErrors"[39m)[33m;[39m
    [90m   | [39m                   [31m^[39m
    [90m174| [39m    [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"criticalErrors"[39m)[33m;[39m
    [90m175| [39m    [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"unresolvedErrors"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mTask Procedures Integration Tests[2m > [22mtask.update[2m > [22mshould update task with valid data
[31m[1mTRPCError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2m‚ùØ[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
    [90m199| [39m[35mexport[39m [35mfunction[39m [34mgetClientIp[39m(req[33m:[39m any)[33m:[39m string [33m|[39m undefined {
    [90m200| [39m  [35mreturn[39m (
    [90m201| [39m    req[33m.[39mheaders[[32m'x-forwarded-for'[39m][33m?.[39m[34msplit[39m([32m','[39m)[[34m0[39m][33m?.[39m[34mtrim[39m() [33m||[39m
    [90m   | [39m        [31m^[39m
    [90m202| [39m    req[33m.[39mheaders[[32m'x-real-ip'[39m] [33m||[39m
    [90m203| [39m    req[33m.[39msocket[33m?.[39mremoteAddress [33m||[39m
[90m [2m‚ùØ[22m server/routers/taskRouter.ts:[2m194:9[22m[39m
[90m [2m‚ùØ[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2m‚ùØ[22m server/routers.test.ts:[2m171:22[22m[39m

[31m[1mCaused by: TypeError[22m: Cannot read properties of undefined (reading 'x-forwarded-for')[39m
[36m [2m‚ùØ[22m getClientIp server/auditTrail.ts:[2m201:9[22m[39m
[90m [2m‚ùØ[22m server/routers/taskRouter.ts:[2m194:9[22m[39m
[90m [2m‚ùØ[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2m‚ùØ[22m server/routers.test.ts:[2m171:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[16/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/routers.test.ts[2m > [22mDefect Procedures Integration Tests[2m > [22mdefect.create[2m > [22mshould create defect with valid input
[31m[1mTRPCError[22m: [
  {
    "expected": "number",
    "code": "invalid_type",
    "path": [
      "projectId"
    ],
    "message": "Invalid input: expected number, received undefined"
  }
][39m
[90m [2m‚ùØ[22m inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m44:10[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[36m [2m‚ùØ[22m server/routers.test.ts:[2m387:22[22m[39m
    [90m385| [39m      const caller = createCaller(createTestContext(testUserId, 'admin‚Ä¶
    [90m386| [39m
    [90m387| [39m      [35mconst[39m result [33m=[39m [35mawait[39m caller[33m.[39mdefect[33m.[39m[34mcreate[39m({
    [90m   | [39m                     [31m^[39m
    [90m388| [39m        title[33m:[39m [32m'Test Defect'[39m[33m,[39m
    [90m389| [39m        description[33m:[39m [32m'Test defect description'[39m[33m,[39m

[31m[1mCaused by: ZodError[22m: [
  {
    "expected": "number",
    "code": "invalid_type",
    "path": [
      "projectId"
    ],
    "message": "Invalid input: expected number, received undefined"
  }
][39m
[90m [2m‚ùØ[22m inputValidatorMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m42:24[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ _zod: { traits: { constructor: 'Function<Set>', has: 'Function<has>', add: 'Function<add>', delete: 'Function<delete>', clear: 'Function<clear>', entries: 'Function<entries>', forEach: 'Function<forEach>', size: 2, values: 'Function<values>', keys: 'Function<values>', union: 'Function<union>', intersection: 'Function<intersection>', difference: 'Function<difference>', symmetricDifference: 'Function<symmetricDifference>', isSubsetOf: 'Function<isSubsetOf>', isSupersetOf: 'Function<isSupersetOf>', isDisjointFrom: 'Function<isDisjointFrom>' }, constr: 'Function<ZodError>', def: [ { expected: 'number', code: 'invalid_type', path: [ 'projectId' ], message: 'Invalid input: expected number, received undefined' } ], deferred: [] }, issues: [ { expected: 'number', code: 'invalid_type', path: [ 'projectId' ], message: 'Invalid input: expected number, received undefined' } ], format: 'Function<value>', flatten: 'Function<value>', addIssue: 'Function<value>', addIssues: 'Function<value>', isEmpty: false }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[17/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould update checklist item result
[31m[1mTRPCError[22m: No procedure found on path "inspection,updateChecklistItem"[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m293:28[22m[39m
[36m [2m‚ùØ[22m tests/checklist-item-update.test.ts:[2m94:20[22m[39m
    [90m 92| [39m    })[33m;[39m
    [90m 93| [39m
    [90m 94| [39m    [35mconst[39m result [33m=[39m [35mawait[39m caller[33m.[39minspection[33m.[39m[34mupdateChecklistItem[39m({
    [90m   | [39m                   [31m^[39m
    [90m 95| [39m      itemResultId[33m:[39m testItemResult[33m.[39mid[33m,[39m
    [90m 96| [39m      result[33m:[39m [32m"fail"[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[18/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/checklist-item-update.test.ts[2m > [22mChecklist Item Update[2m > [22mshould update only result without comments
[31m[1mTRPCError[22m: No procedure found on path "inspection,updateChecklistItem"[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m293:28[22m[39m
[36m [2m‚ùØ[22m tests/checklist-item-update.test.ts:[2m115:5[22m[39m
    [90m113| [39m    })[33m;[39m
    [90m114| [39m
    [90m115| [39m    [35mawait[39m caller[33m.[39minspection[33m.[39m[34mupdateChecklistItem[39m({
    [90m   | [39m    [31m^[39m
    [90m116| [39m      itemResultId[33m:[39m testItemResult[33m.[39mid[33m,[39m
    [90m117| [39m      result[33m:[39m [32m"na"[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[19/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateProject - Project Creation Transaction[2m > [22mshould prevent duplicate project codes
[31m[1mAssertionError[22m: promise resolved "{ id: 600008, ‚Ä¶(18) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Error {[39m
[32m-   "message": "rejected promise",[39m
[31m+ {[39m
[31m+   "archivedAt": null,[39m
[31m+   "archivedBy": null,[39m
[31m+   "archivedReason": null,[39m
[31m+   "budget": null,[39m
[31m+   "code": "UNIQUE-1763895532475",[39m
[31m+   "color": "#3B82F6",[39m
[31m+   "completionPercentage": 0,[39m
[31m+   "createdAt": 2025-11-23T10:58:54.000Z,[39m
[31m+   "createdBy": 1,[39m
[31m+   "endDate": null,[39m
[31m+   "id": 600008,[39m
[31m+   "latitude": null,[39m
[31m+   "location": null,[39m
[31m+   "longitude": null,[39m
[31m+   "name": "Second Project",[39m
[31m+   "ownerName": null,[39m
[31m+   "startDate": null,[39m
[31m+   "status": "planning",[39m
[31m+   "updatedAt": 2025-11-23T10:58:54.000Z,[39m
[2m  }[22m

[36m [2m‚ùØ[22m server/__tests__/critical-transactions.test.ts:[2m173:7[22m[39m
    [90m171| [39m          status[33m:[39m [32m'planning'[39m [35mas[39m [35mconst[39m[33m,[39m
    [90m172| [39m        })
    [90m173| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m174| [39m    })[33m;[39m
    [90m175| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[20/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould create defect with valid data
[31m[1mTRPCError[22m: Failed to create defect[39m
[36m [2m‚ùØ[22m server/routers/defectRouter.ts:[2m183:17[22m[39m
    [90m181| [39m        [35mconst[39m defectId [33m=[39m [33mNumber[39m((result [35mas[39m any)[33m.[39minsertId)[33m;[39m
    [90m182| [39m        [35mif[39m ([34misNaN[39m(defectId) [33m||[39m defectId [33m<[39m [34m0[39m) {
    [90m183| [39m          [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m                [31m^[39m
    [90m184| [39m            code[33m:[39m [32m"INTERNAL_SERVER_ERROR"[39m[33m,[39m
    [90m185| [39m            message[33m:[39m [32m"Failed to create defect"[39m[33m,[39m
[90m [2m‚ùØ[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2m‚ùØ[22m server/__tests__/critical-transactions.test.ts:[2m227:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[21/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mcreateDefect - Defect Creation Transaction[2m > [22mshould set default status to reported
[31m[1mTRPCError[22m: Failed to create defect[39m
[36m [2m‚ùØ[22m server/routers/defectRouter.ts:[2m183:17[22m[39m
    [90m181| [39m        [35mconst[39m defectId [33m=[39m [33mNumber[39m((result [35mas[39m any)[33m.[39minsertId)[33m;[39m
    [90m182| [39m        [35mif[39m ([34misNaN[39m(defectId) [33m||[39m defectId [33m<[39m [34m0[39m) {
    [90m183| [39m          [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m                [31m^[39m
    [90m184| [39m            code[33m:[39m [32m"INTERNAL_SERVER_ERROR"[39m[33m,[39m
    [90m185| [39m            message[33m:[39m [32m"Failed to create defect"[39m[33m,[39m
[90m [2m‚ùØ[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2m‚ùØ[22m server/__tests__/critical-transactions.test.ts:[2m269:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/critical-transactions.test.ts[2m > [22mCritical Transaction Tests[2m > [22mDatabase Integrity Tests[2m > [22mshould maintain referential integrity on project deletion
[31m[1mTRPCError[22m: Failed to create defect[39m
[36m [2m‚ùØ[22m server/routers/defectRouter.ts:[2m183:17[22m[39m
    [90m181| [39m        [35mconst[39m defectId [33m=[39m [33mNumber[39m((result [35mas[39m any)[33m.[39minsertId)[33m;[39m
    [90m182| [39m        [35mif[39m ([34misNaN[39m(defectId) [33m||[39m defectId [33m<[39m [34m0[39m) {
    [90m183| [39m          [35mthrow[39m [35mnew[39m [33mTRPCError[39m({
    [90m   | [39m                [31m^[39m
    [90m184| [39m            code[33m:[39m [32m"INTERNAL_SERVER_ERROR"[39m[33m,[39m
    [90m185| [39m            message[33m:[39m [32m"Failed to create defect"[39m[33m,[39m
[90m [2m‚ùØ[22m resolveMiddleware node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m221:17[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m callRecursive node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m256:18[22m[39m
[90m [2m‚ùØ[22m procedure node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/initTRPC-CB9uBez5.mjs:[2m281:18[22m[39m
[90m [2m‚ùØ[22m node_modules/.pnpm/@trpc+server@11.6.0_typescript@5.9.3/node_modules/@trpc/server/dist/tracked-Blz8XOf1.mjs:[2m298:13[22m[39m
[90m [2m‚ùØ[22m server/__tests__/critical-transactions.test.ts:[2m438:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[23/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mlist procedure[2m > [22mshould return paginated projects list
[31m[1mAssertionError[22m: expected 25 to be 10 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 25[39m

[36m [2m‚ùØ[22m server/__tests__/projects-simple.test.ts:[2m47:42[22m[39m
    [90m 45| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(result[33m.[39mitems))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 46| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mcurrentPage)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m 47| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mpageSize)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m 48| [39m    })[33m;[39m
    [90m 49| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[24/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mget procedure[2m > [22mshould return null for non-existent project
[31m[1mAssertionError[22m: expected undefined to be null[39m

[32m- Expected:[39m 
null

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m server/__tests__/projects-simple.test.ts:[2m72:22[22m[39m
    [90m 70| [39m      [35mconst[39m result [33m=[39m [35mawait[39m caller[33m.[39mproject[33m.[39m[35mget[39m({ id[33m:[39m [34m999999[39m })[33m;[39m
    [90m 71| [39m      
    [90m 72| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeNull[39m()[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m 73| [39m    })[33m;[39m
    [90m 74| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[25/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mcreate procedure[2m > [22mshould create a new project
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m server/__tests__/projects-simple.test.ts:[2m120:30[22m[39m
    [90m118| [39m
    [90m119| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m120| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m121| [39m      [34mexpect[39m(result[33m.[39mid)[33m.[39m[34mtoBeTypeOf[39m([32m'number'[39m)[33m;[39m
    [90m122| [39m      [34mexpect[39m(result[33m.[39mid)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[26/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects-simple.test.ts[2m > [22mProjects Router - Simple Tests[2m > [22mupdate procedure[2m > [22mshould update an existing project
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m server/__tests__/projects-simple.test.ts:[2m168:30[22m[39m
    [90m166| [39m
    [90m167| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m168| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m169| [39m      
    [90m170| [39m      [90m// Verify the update[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[27/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mcreateProject[2m > [22mshould create a new project successfully
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m server/__tests__/projects.test.ts:[2m68:30[22m[39m
    [90m 66| [39m
    [90m 67| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 68| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 69| [39m      [34mexpect[39m(result[33m.[39mid)[33m.[39m[34mtoBeTypeOf[39m([32m'number'[39m)[33m;[39m
    [90m 70| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[28/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m server/__tests__/projects.test.ts[2m > [22mProjects Router[2m > [22mlistProjects[2m > [22mshould list all projects with pagination
[31m[1mAssertionError[22m: expected 25 to be 10 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 25[39m

[36m [2m‚ùØ[22m server/__tests__/projects.test.ts:[2m130:42[22m[39m
    [90m128| [39m      [34mexpect[39m(result[33m.[39mpagination)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m129| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mcurrentPage)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m130| [39m      [34mexpect[39m(result[33m.[39mpagination[33m.[39mpageSize)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m131| [39m    })[33m;[39m
    [90m132| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[29/30]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/security.test.ts[2m > [22mSecurity Features[2m > [22mInput Validation[2m > [22mshould validate file upload size
[31m[1mAssertionError[22m: expected [ 400, 413 ] to include 403[39m
[36m [2m‚ùØ[22m tests/integration/security.test.ts:[2m114:26[22m[39m
    [90m112| [39m
    [90m113| [39m      [90m// Should reject oversized files[39m
    [90m114| [39m      [34mexpect[39m([[34m400[39m[33m,[39m [34m413[39m])[33m.[39m[34mtoContain[39m(response[33m.[39mstatus)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m115| [39m    })[33m;[39m
    [90m116| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[30/30]‚éØ[22m[39m


[2m Test Files [22m [1m[31m11 failed[39m[22m[2m | [22m[1m[32m18 passed[39m[22m[2m | [22m[33m2 skipped[39m[90m (31)[39m
[2m      Tests [22m [1m[31m24 failed[39m[22m[2m | [22m[1m[32m254 passed[39m[22m[2m | [22m[33m22 skipped[39m[90m (300)[39m
[2m   Start at [22m 05:58:46
[2m   Duration [22m 34.57s[2m (transform 4.44s, setup 0ms, collect 22.58s, tests 137.53s, environment 5ms, prepare 198ms)[22m

‚ÄâELIFECYCLE‚Äâ Test failed. See above for more details.
